# 		蓝鲸平台7.1版本脱敏方案

**用途**：规范各子平台敏感信息修改操作，确保系统部署符合企业安全要求

**编写日期**：2025年06月20日 



[TOC]





### cmdb配置平台

#### 1、底部连接和title

配置平台的底部连接和title是可以在页面上去配置修改的，页面路径：进入到cmdb-->平台管理-->平台信息去修改即可：（业务通用里的快照信息不能修改和平台信息里的联系方式不能为空，可以先不改，等下在下面mongo里面修改）
![image-20250613112630713](https://raw.githubusercontent.com/XH1994/image-hosting/blueking/image-20250613112630713.png)



#### 2、业务名称修改

蓝鲸平台部署完之后会有一个默认的业务ID2，业务名叫蓝鲸，这个需要到数据库上去修改，cmdb的数据都存在mongodb上，具体操作如下：

```shell
# 部署完蓝鲸平台之后，默认都会装上k9s方便我们管理，下面用k9s来演示。
1）k9s连接上，找到蓝鲸的命名空间，blueking,找到mongodb的pod（进入到k9s之后，冒号输入ns,就能去到命名空间，找到blueking，回车键进去，用斜杠号去查找，里面的操作和vim差不多，/mongodb,看到有个pod名称为bk-mongodb-0这个就是蓝鲸平台的mongodb，按s进入到pod。)

2）连接mongodb需要先找到他的用户和密码
I have no name!@bk-mongodb-0:/$ env | grep -i mongodb|egrep -i "user|password"
MONGODB_ROOT_USER=root
MONGODB_ROOT_PASSWORD=blueking

3）修改前先备份
mkdir -p /bitnami/mongodb/db-backup
mongodump --host=127.0.0.1 --port=27017 --username=root --password="blueking" --authenticationDatabase=admin --db=cmdb --gzip --out=/bitnami/mongodb/db-backup/cmdb_db

#然后把备份的目录传到本地即可，多开一个窗口，在k8s-master上执行：
mkdir -p /data/blueking/db-backup/mongodb
kubectl cp blueking/bk-mongodb-0:bitnami/mongodb/db-backup/cmdb_db /data/blueking/db-backup/mongodb/cmdb_db

4）连接mongo，进入cmdb的库，找到对应的集合去修改。
I have no name!@bk-mongodb-0:/$ mongo mongodb://root:blueking@127.0.0.1:27017

rs0:PRIMARY> show dbs;
admin        0.000GB
bkrepo       0.041GB
cmdb         0.006GB
cmdb_events  0.001GB
config       0.000GB
gse          0.000GB
joblog       0.001GB
local        0.057GB
rs0:PRIMARY> use cmdb
switched to db cmdb
rs0:PRIMARY> show collections;
# 我们只需要关注两张表，cc_ApplicationBase，cc_System
cc_ApplicationBase
cc_System
...
...
...

# 业务名在cc_ApplicationBase这个表里。bk_biz_name为蓝鲸的，先db.find()查看
rs0:PRIMARY> db.cc_ApplicationBase.find().pretty()
{
	"_id" : ObjectId("683839788c31832e66ecc87e"),
	"bk_biz_productor" : "admin",
	"language" : "1",
	"default" : 1,
	"create_time" : ISODate("2025-05-29T10:39:52.909Z"),
	"bk_biz_tester" : "",
	"bk_biz_name" : "资源池",
	"bk_biz_maintainer" : "admin",
	"time_zone" : "Asia/Shanghai",
	"life_cycle" : "2",
	"bk_biz_developer" : "",
	"bk_supplier_account" : "0",
	"last_time" : ISODate("2025-05-29T10:39:52.909Z"),
	"operator" : "",
	"bk_biz_id" : NumberLong(1)
}
{
	"_id" : ObjectId("683839788c31832e66ecc882"),
	"bk_biz_maintainer" : "admin",
	"bk_supplier_account" : "0",
	"bk_biz_tester" : "",
	"create_time" : ISODate("2025-05-29T10:39:52.917Z"),
	"life_cycle" : "2",
	"bk_biz_developer" : "",
	"operator" : "",
	"last_time" : ISODate("2025-05-29T10:39:52.917Z"),
	"bk_biz_name" : "蓝鲸",
	"default" : 0,
	"time_zone" : "Asia/Shanghai",
	"language" : "1",
	"bk_biz_productor" : "",
	"bk_biz_id" : NumberLong(2)
}
{
	"_id" : ObjectId("683e70dc18b7f6fa866890dd"),
	"bk_supplier_account" : "0",
	"language" : "1",
	"last_time" : ISODate("2025-06-03T03:49:48.717Z"),
	"bk_biz_developer" : "",
	"bk_biz_maintainer" : "admin",
	"time_zone" : "Asia/Shanghai",
	"bk_biz_id" : NumberLong(3),
	"bk_biz_name" : "思倍云",
	"life_cycle" : "2",
	"operator" : "",
	"create_time" : ISODate("2025-06-03T03:49:48.717Z"),
	"bk_biz_productor" : "",
	"default" : NumberLong(0),
	"bk_biz_tester" : ""
}

# 修改bk_biz_name蓝鲸为运维平台
rs0:PRIMARY> db.cc_ApplicationBase.updateOne(
  {
    "bk_biz_id": 2, 
    "bk_biz_name": "蓝鲸"
  },
  {
    $set: {"bk_biz_name": "运维平台"}
  }
)
# 修改完查看修改成功即可
rs0:PRIMARY> db.cc_ApplicationBase.find(
  {"bk_biz_id": 2}, 
  {"bk_biz_name": 1, "_id": 0}
).pretty()
# 显示以下内容：
{ "bk_biz_name" : "运维平台" }

# 修改cc_System，上面的一些快照信息和联系方式存在这里，可以修改这个集合。
# 先查看内容：
rs0:PRIMARY> db.cc_System.findOne({_id: "configadmin"}, {config: 1})
{
	"_id" : "configadmin",
	"config" : "{\"backend\":{\"max_biz_topo_level\":7,\"snapshot_biz_name\":\"蓝鲸\"},\"site\":{\"name\":{\"value\":\"配置平台 | 腾讯蓝鲸智云\",\"description\":\"网站标题\",\"i18n\":{\"cn\":\"配置平台 | 腾讯蓝鲸智云\",\"en\":\"CMDB | Tencent BlueKing\"}},\"separator\":\"|\"},\"footer\":{\"contact\":{\"value\":\"[技术支持](https://wpa1.qq.com/KziXGWJs?_type=wpa\\u0026qidian=true) | [社区论坛](https://bk.tencent.com/s-mart/community/) | [产品官网](https://bk.tencent.com/index/)\",\"description\":\"\",\"i18n\":{\"cn\":\"[技术支持](https://wpa1.qq.com/KziXGWJs?_type=wpa\\u0026qidian=true) | [社区论坛](https://bk.tencent.com/s-mart/community/) | [产品官网](https://bk.tencent.com/index/)\",\"en\":\"[Support](https://wpa1.qq.com/KziXGWJs?_type=wpa\\u0026amp;qidian=true) | [Forum](https://bk.tencent.com/s-mart/community/) | [Official](https://bk.tencent.com/index/)\"}},\"copyright\":{\"value\":\"Copyright © 2012-{{current_year}} Tencent BlueKing. All Rights Reserved.\",\"description\":\"版权信息\",\"i18n\":{\"cn\":\"Copyright © 2012-{{current_year}} Tencent BlueKing. All Rights Reserved.\",\"en\":\"Copyright © 2012-{{current_year}} Tencent BlueKing. All Rights Reserved.\"}}},\"validation_rules\":{\"number\":{\"value\":\"XihcLXxcKyk/XGQrJA==\",\"description\":\"字段类型“数字”的验证规则\",\"i18n\":{\"cn\":\"请输入整数数字\",\"en\":\"Please enter integer number\"}},\"float\":{\"value\":\"XlsrLV0/KFswLTldKlsuXT9bMC05XSt8WzAtOV0rWy5dP1swLTldKikoW2VFXVsrLV0/WzAtOV0rKT8k\",\"description\":\"字段类型“浮点”的验证规则\",\"i18n\":{\"cn\":\"请输入浮点型数字\",\"en\":\"Please enter float data\"}},\"singlechar\":{\"value\":\"XFMq\",\"description\":\"字段类型“短字符”的验证规则\",\"i18n\":{\"cn\":\"请输入256长度以内的字符串\",\"en\":\"Please enter the string within 256 length\"}},\"longchar\":{\"value\":\"XFMq\",\"description\":\"字段类型“长字符”的验证规则\",\"i18n\":{\"cn\":\"请输入2000长度以内的字符串\",\"en\":\"Please enter the string within 2000 length\"}},\"associationId\":{\"value\":\"XlthLXpBLVpdW1x3XSok\",\"description\":\"关联类型唯一标识验证规则\",\"i18n\":{\"cn\":\"由英文字符开头，和下划线、数字或英文组合的字符\",\"en\":\"Start with lowercase or uppercase letter, followed by lowercase / uppercase / underscore / numbers characters\"}},\"classifyId\":{\"value\":\"XlthLXpBLVpdW1x3XSok\",\"description\":\"模型分组唯一标识验证规则\",\"i18n\":{\"cn\":\"由英文字符开头，和下划线、数字或英文组合的字符\",\"en\":\"Start with lowercase or uppercase letter, followed by lowercase / uppercase / underscore / numbers characters\"}},\"modelId\":{\"value\":\"XlthLXpBLVpdW1x3XSok\",\"description\":\"模型唯一标识验证规则\",\"i18n\":{\"cn\":\"由英文字符开头，和下划线、数字或英文组合的字符\",\"en\":\"Start with lowercase or uppercase letter, followed by lowercase / uppercase / underscore / numbers characters\"}},\"enumId\":{\"value\":\"XlthLXpBLVowLTlfLV0qJA==\",\"description\":\"字段类型“枚举”ID的验证规则\",\"i18n\":{\"cn\":\"由大小写英文字母，数字，_ 或 - 组成的字符\",\"en\":\"Composed of uppercase / lowercase / numbers / - or _ characters\"}},\"enumName\":{\"value\":\"XihbYS16QS1aMC05X118W1x1NGUwMC1cdTlmYTVdfFsoKSst44CK44CLLO+8jO+8mzvigJzigJ3igJjigJnjgIJcLlwiXCcgXC86XSkqJA==\",\"description\":\"字段类型“枚举”值的验证规则\",\"i18n\":{\"cn\":\"请输入枚举值\",\"en\":\"Please enter the enum value\"}},\"fieldId\":{\"value\":\"XlthLXpBLVpdW1x3XSok\",\"description\":\"模型字段唯一标识的验证规则\",\"i18n\":{\"cn\":\"由英文字符开头，和下划线、数字或英文组合的字符\",\"en\":\"Start with lowercase or uppercase letter, followed by lowercase / uppercase / underscore / numbers characters\"}},\"namedCharacter\":{\"value\":\"XlthLXpBLVowLTlcdTRlMDAtXHU5ZmE1X1wtOlwoXCldKyQ=\",\"description\":\"服务分类名称的验证规则\",\"i18n\":{\"cn\":\"请输入中英文或特殊字符 :_- 组成的名称\",\"en\":\"Special symbols only support(:_-)\"}},\"instanceTagKey\":{\"value\":\"XlthLXpBLVpdKFthLXowLTlBLVpcLV8uXSpbYS16MC05QS1aXSk/JA==\",\"description\":\"服务实例标签键的验证规则\",\"i18n\":{\"cn\":\"请输入以英文开头的英文+数字组合\",\"en\":\"Please enter letter / number starts with letter\"}},\"instanceTagValue\":{\"value\":\"XlthLXowLTlBLVpdKFthLXowLTlBLVpcLV8uXSpbYS16MC05QS1aXSk/JA==\",\"description\":\"服务实例标签值的验证规则\",\"i18n\":{\"cn\":\"请输入英文 / 数字\",\"en\":\"Please enter letter / number\"}},\"businessTopoInstNames\":{\"value\":\"XlteXCNcLyxcPlw8XHxdKyQ=\",\"description\":\"集群/模块/实例名称的验证规则\",\"i18n\":{\"cn\":\"请输入除 #/,\\u003e\\u003c| 以外的字符\",\"en\":\"Please enter characters other than #/,\\u003e\\u003c|\"}}},\"set\":\"空闲机池\",\"idle_pool\":{\"idle\":\"空闲机\",\"fault\":\"故障机\",\"recycle\":\"待回收\",\"user_modules\":null}}"
}

# 修改config：
rs0:PRIMARY> db.cc_System.updateOne(
  { "_id": "configadmin" },
  { $set: { 
      "config" : "{\"backend\":{\"max_biz_topo_level\":7,\"snapshot_biz_name\":\"运维平台\"},\"site\":{\"name\":{\"value\":\"配置平台 | 运维平台\",\"description\":\"网站标题\",\"i18n\":{\"cn\":\"配置平台 | 运维平台\",\"en\":\"CMDB | Tencent BlueKing\"}},\"separator\":\"|\"},\"footer\":{\"contact\":{\"value\":\"\",\"description\":\"\",\"i18n\":{\"cn\":\"运维平台\",\"en\":\"[Support](https://wpa1.qq.com/KziXGWJs?_type=wpa\\u0026amp;qidian=true) | [Forum](https://bk.tencent.com/s-mart/community/) | [Official](https://bk.tencent.com/index/)\"}},\"copyright\":{\"value\":\"Copyright © 2012-{{current_year}} Tencent BlueKing. All Rights Reserved.\",\"description\":\"版权信息\",\"i18n\":{\"cn\":\"运维平台\",\"en\":\"Copyright © 2012-{{current_year}} Tencent BlueKing. All Rights Reserved.\"}}},\"validation_rules\":{\"number\":{\"value\":\"XihcLXxcKyk/XGQrJA==\",\"description\":\"字段类型“数字”的验证规则\",\"i18n\":{\"cn\":\"请输入整数数字\",\"en\":\"Please enter integer number\"}},\"float\":{\"value\":\"XlsrLV0/KFswLTldKlsuXT9bMC05XSt8WzAtOV0rWy5dP1swLTldKikoW2VFXVsrLV0/WzAtOV0rKT8k\",\"description\":\"字段类型“浮点”的验证规则\",\"i18n\":{\"cn\":\"请输入浮点型数字\",\"en\":\"Please enter float data\"}},\"singlechar\":{\"value\":\"XFMq\",\"description\":\"字段类型“短字符”的验证规则\",\"i18n\":{\"cn\":\"请输入256长度以内的字符串\",\"en\":\"Please enter the string within 256 length\"}},\"longchar\":{\"value\":\"XFMq\",\"description\":\"字段类型“长字符”的验证规则\",\"i18n\":{\"cn\":\"请输入2000长度以内的字符串\",\"en\":\"Please enter the string within 2000 length\"}},\"associationId\":{\"value\":\"XlthLXpBLVpdW1x3XSok\",\"description\":\"关联类型唯一标识验证规则\",\"i18n\":{\"cn\":\"由英文字符开头，和下划线、数字或英文组合的字符\",\"en\":\"Start with lowercase or uppercase letter, followed by lowercase / uppercase / underscore / numbers characters\"}},\"classifyId\":{\"value\":\"XlthLXpBLVpdW1x3XSok\",\"description\":\"模型分组唯一标识验证规则\",\"i18n\":{\"cn\":\"由英文字符开头，和下划线、数字或英文组合的字符\",\"en\":\"Start with lowercase or uppercase letter, followed by lowercase / uppercase / underscore / numbers characters\"}},\"modelId\":{\"value\":\"XlthLXpBLVpdW1x3XSok\",\"description\":\"模型唯一标识验证规则\",\"i18n\":{\"cn\":\"由英文字符开头，和下划线、数字或英文组合的字符\",\"en\":\"Start with lowercase or uppercase letter, followed by lowercase / uppercase / underscore / numbers characters\"}},\"enumId\":{\"value\":\"XlthLXpBLVowLTlfLV0qJA==\",\"description\":\"字段类型“枚举”ID的验证规则\",\"i18n\":{\"cn\":\"由大小写英文字母，数字，_ 或 - 组成的字符\",\"en\":\"Composed of uppercase / lowercase / numbers / - or _ characters\"}},\"enumName\":{\"value\":\"XihbYS16QS1aMC05X118W1x1NGUwMC1cdTlmYTVdfFsoKSst44CK44CLLO+8jO+8mzvigJzigJ3igJjigJnjgIJcLlwiXCcgXC86XSkqJA==\",\"description\":\"字段类型“枚举”值的验证规则\",\"i18n\":{\"cn\":\"请输入枚举值\",\"en\":\"Please enter the enum value\"}},\"fieldId\":{\"value\":\"XlthLXpBLVpdW1x3XSok\",\"description\":\"模型字段唯一标识的验证规则\",\"i18n\":{\"cn\":\"由英文字符开头，和下划线、数字或英文组合的字符\",\"en\":\"Start with lowercase or uppercase letter, followed by lowercase / uppercase / underscore / numbers characters\"}},\"namedCharacter\":{\"value\":\"XlthLXpBLVowLTlcdTRlMDAtXHU5ZmE1X1wtOlwoXCldKyQ=\",\"description\":\"服务分类名称的验证规则\",\"i18n\":{\"cn\":\"请输入中英文或特殊字符 :_- 组成的名称\",\"en\":\"Special symbols only support(:_-)\"}},\"instanceTagKey\":{\"value\":\"XlthLXpBLVpdKFthLXowLTlBLVpcLV8uXSpbYS16MC05QS1aXSk/JA==\",\"description\":\"服务实例标签键的验证规则\",\"i18n\":{\"cn\":\"请输入以英文开头的英文+数字组合\",\"en\":\"Please enter letter / number starts with letter\"}},\"instanceTagValue\":{\"value\":\"XlthLXowLTlBLVpdKFthLXowLTlBLVpcLV8uXSpbYS16MC05QS1aXSk/JA==\",\"description\":\"服务实例标签值的验证规则\",\"i18n\":{\"cn\":\"请输入英文 / 数字\",\"en\":\"Please enter letter / number\"}},\"businessTopoInstNames\":{\"value\":\"XlteXCNcLyxcPlw8XHxdKyQ=\",\"description\":\"集群/模块/实例名称的验证规则\",\"i18n\":{\"cn\":\"请输入除 #/,\\u003e\\u003c| 以外的字符\",\"en\":\"Please enter characters other than #/,\\u003e\\u003c|\"}}},\"set\":\"空闲机池\",\"idle_pool\":{\"idle\":\"空闲机\",\"fault\":\"故障机\",\"recycle\":\"待回收\",\"user_modules\":[]}}"
    }
  }
)

# 修改完了检查一下。
rs0:PRIMARY> db.cc_System.findOne({_id: "configadmin"}, {config: 1})
{
	"_id" : "configadmin",
	"config" : "{\"backend\":{\"max_biz_topo_level\":7,\"snapshot_biz_name\":\"深体\"},\"site\":{\"name\":{\"value\":\"配置平台 | 深体运维平台\",\"description\":\"网站标题\",\"i18n\":{\"cn\":\"配置平台 | 深体运维平台\",\"en\":\"CMDB | Tencent BlueKing\"}},\"separator\":\"|\"},\"footer\":{\"contact\":{\"value\":\"\",\"description\":\"\",\"i18n\":{\"cn\":\"\",\"en\":\"[Support](https://wpa1.qq.com/KziXGWJs?_type=wpa\\u0026amp;qidian=true)| [Forum](https://bk.tencent.com/s-mart/community/) | [Official](https://bk.tencent.com/index/)\"}},\"copyright\":{\"value\":\"Copyright © 2012-{{current_year}} Tencent BlueKing. All Rights Reserved.\",\"description\":\"版权信息\",\"i18n\":{\"cn\":\"深体运维平台\",\"en\":\"Copyright © 2012-{{current_year}}Tencent BlueKing. All Rights Reserved.\"}}},\"validation_rules\":{\"number\":{\"value\":\"XihcLXxcKyk/XGQrJA==\",\"description\":\"字段类型“数字”的验证规则\",\"i18n\":{\"cn\":\"请输入整数数字\",\"en\":\"Please enter integer number\"}},\"float\":{\"value\":\"XlsrLV0/KFswLTldKlsuXT9bMC05XSt8WzAtOV0rWy5dP1swLTldKikoW2VFXVsrLV0/WzAtOV0rKT8k\",\"description\":\"字段类型“浮点”的验证规则\",\"i18n\":{\"cn\":\"请输入浮点型数字\",\"en\":\"Please enter float data\"}},\"singlechar\":{\"value\":\"XFMq\",\"description\":\"字段类型“短字符”的验证规则\",\"i18n\":{\"cn\":\"请输入256长度以内的字符串\",\"en\":\"Please enter the string within 256 length\"}},\"longchar\":{\"value\":\"XFMq\",\"description\":\"字段类型“长字符”的验证规则\",\"i18n\":{\"cn\":\"请输入2000长度以内的字符串\",\"en\":\"Please enter the string within 2000 length\"}},\"associationId\":{\"value\":\"XlthLXpBLVpdW1x3XSok\",\"description\":\"关联类型唯一标识验证规则\",\"i18n\":{\"cn\":\"由英文字符开头，和下划线、数字或英文组合的字符\",\"en\":\"Start with lowercase or uppercase letter, followed by lowercase / uppercase / underscore / numbers characters\"}},\"classifyId\":{\"value\":\"XlthLXpBLVpdW1x3XSok\",\"description\":\"模型分组唯一标识验证规则\",\"i18n\":{\"cn\":\"由英文字符开头，和下划线、数字或英文组合的字符\",\"en\":\"Start with lowercase or uppercase letter, followed by lowercase / uppercase / underscore /numbers characters\"}},\"modelId\":{\"value\":\"XlthLXpBLVpdW1x3XSok\",\"description\":\"模型唯一标识验证规则\",\"i18n\":{\"cn\":\"由英文字符开头，和下划线、数字或英文组合的字符\",\"en\":\"Start with lowercase or uppercase letter, followed by lowercase / uppercase / underscore / numbers characters\"}},\"enumId\":{\"value\":\"XlthLXpBLVowLTlfLV0qJA==\",\"description\":\"字段类型“枚举”ID的验证规则\",\"i18n\":{\"cn\":\"由大小写英文字母，数字，_ 或 - 组成的字符\",\"en\":\"Composed of uppercase / lowercase / numbers / - or _ characters\"}},\"enumName\":{\"value\":\"XihbYS16QS1aMC05X118W1x1NGUwMC1cdTlmYTVdfFsoKSst44CK44CLLO+8jO+8mzvigJzigJ3igJjigJnjgIJcLlwiXCcgXC86XSkqJA==\",\"description\":\"字段类型“枚举”值的验证规则\",\"i18n\":{\"cn\":\"请输入枚举值\",\"en\":\"Please enter the enum value\"}},\"fieldId\":{\"value\":\"XlthLXpBLVpdW1x3XSok\",\"description\":\"模型字段唯一标识的验证规则\",\"i18n\":{\"cn\":\"由英文字符开头，和下划线、数字或英文组合的字符\",\"en\":\"Start with lowercase or uppercase letter, followed by lowercase / uppercase / underscore / numbers characters\"}},\"namedCharacter\":{\"value\":\"XlthLXpBLVowLTlcdTRlMDAtXHU5ZmE1X1wtOlwoXCldKyQ=\",\"description\":\"服务分类名称的验证规则\",\"i18n\":{\"cn\":\"请输入中英文或特殊字符 :_- 组成的名称\",\"en\":\"Special symbols only support(:_-)\"}},\"instanceTagKey\":{\"value\":\"XlthLXpBLVpdKFthLXowLTlBLVpcLV8uXSpbYS16MC05QS1aXSk/JA==\",\"description\":\"服务实例标签键的验证规则\",\"i18n\":{\"cn\":\"请输入以英文开头的英文+数字组合\",\"en\":\"Please enter letter /number starts with letter\"}},\"instanceTagValue\":{\"value\":\"XlthLXowLTlBLVpdKFthLXowLTlBLVpcLV8uXSpbYS16MC05QS1aXSk/JA==\",\"description\":\"服务实例标签值的验证规则\",\"i18n\":{\"cn\":\"请输入英文 / 数字\",\"en\":\"Please enter letter / number\"}},\"businessTopoInstNames\":{\"value\":\"XlteXCNcLyxcPlw8XHxdKyQ=\",\"description\":\"集群/模块/实例名称的验证规则\",\"i18n\":{\"cn\":\"请输入除 #/,\\u003e\\u003c| 以外的字符\",\"en\":\"Please enter charactersother than #/,\\u003e\\u003c|\"}}},\"set\":\"空闲机池\",\"idle_pool\":{\"idle\":\"空闲机\",\"fault\":\"故障机\",\"recycle\":\"待回收\",\"user_modules\":[]}}"
}
```



#### 3、logo文字修改

修改logo文字需要修改js文件，如果直接在pod修改，那么下次pod重启的时候就会还原回原本的js文件，所以需要执行以下操作，把对应的文件下载下来，修改完之后创建对应的pv和pvc，下次重启让他直接用指定的文件。

```shell
1）修改文件需要挂载到pv，但是cmdb的web默认是没有开放挂载的，需要更改以下配置重新打包cmdb的包
mkdir -p /root/bkce7.1-install/tuoming/chart

cd /root/bkce7.1-install/tuoming/chart

tar -zxvf /root/bkce7.1-install/charts/bk-cmdb-3.12.2.tgz -C ./

vim bk-cmdb/templates/webserver/webserver-dpl.yaml
# 把webserver-dpl.yaml的volumeMounts和volumes修改成以下内容：
        volumeMounts:
          {{- if .Values.webserver.volumeMounts }}
          {{- toYaml .Values.webserver.volumeMounts | nindent 12 }}
          {{- end }}
          {{- if .Values.common.monitor.enabled }}
          - name: plugin-path
            mountPath: {{ .Values.common.monitor.pluginPath }}
          {{- end }}
          {{- if .Values.webserver.configDir }}
          - name: configures
            mountPath: {{ .Values.webserver.configDir }}
          {{- end }}
      volumes:
        {{- if .Values.webserver.volumes }}
        {{- toYaml .Values.webserver.volumes | nindent 8 }}
        {{- end }}
        {{- if .Values.common.monitor.enabled }}
        - name: plugin-path
          hostPath:
            path: {{ .Values.common.monitor.pluginPath }}
        {{- end }}
        {{- if .Values.webserver.configDir }}
        - name: configures
          configMap:
            name: {{ .Release.Name }}-webserver-configures
        {{- end }}


2）打包刚刚修改过的cmdb
[root@k8s-master01 cmdb]# helm package bk-cmdb --version=3.12.3 -d /root/bkce7.1-install/charts/

3）修改对应的部署版本
cd /root/bkce7.1-install/blueking
cp environments/default/version.yaml environments/default/version.yaml.$(date +%Y%m%d_%H%M)
sed -i 's/bk-cmdb:.*/bk-cmdb: "3.12.3"/' environments/default/version.yaml
# 检查修改结果
grep bk-cmdb environments/default/version.yaml 
# 正常输出就是：bk-cmdb: "3.12.3"
# 修改部署指定的charts
cat base-blueking.yaml.gotmpl |grep 'bk-cmdb-3.12.2.tgz'
# 正常输出以下内容，如果内容不一样不要用sed去修改，自己手动修改：
# chart: /root/bkce7.1-install/charts/bk-cmdb-3.12.2.tgz
sed -i 's/bk-cmdb-3.12.2.tgz/bk-cmdb-3.12.3.tgz/g' base-blueking.yaml.gotmpl


4）拷贝容器内文件
mkdir -p /root/bkce7.1-install/tuoming/cmdb-js/
kubectl cp $(kubectl get po |grep bk-cmdb-webserver| awk '{print $1}'):web/js/app.81251d67f6ed50ee7e18.js /root/bkce7.1-install/tuoming/cmdb-js/app.81251d67f6ed50ee7e18.js

5）修改文件内容
sed -i 's/蓝鲸配置平台/配置平台/g' /root/bkce7.1-install/tuoming/cmdb-js/app.81251d67f6ed50ee7e18.js

6）创建pv和pvc
# 源目录可以自定义，需要目录所在磁盘有 100GB 以上的空间。此处为了和 bcs.sh 保持一致，使用 /data/bcs/localpv/
src_dir=/data/bcs/localpv/
# pv目录需要和全局 Values 中的 .localpv.hostDir 保持一致
pv_host_dir=/mnt/blueking/
# 创建web所需的目录。
for i in blueking-web; do
  vol="vol$i"
  vol_dir="${pv_host_dir%/}/$vol"
  vol_src="${src_dir%/}/$vol"
  mkdir -p "$vol_dir" "$vol_src";
  if grep -w "$vol_dir" /etc/fstab; then
    echo >&2 "TIP: vol $vol exist in /etc/fstab."
  else
    echo "$vol_src $vol_dir none defaults,bind 0 0" | tee -a /etc/fstab
  fi
done
# 在目录制备完成后，需要mount才能被 localpv provisioner 认可。
mount -va
# 检查挂载结果
grep -w volblueking-web /etc/fstab /proc/self/mounts

# 创建pv和pvc的yaml (注意，我这里绑定的是master节点，因为我的存储卷是在master上的，如果有不一样的修改下面的values,修改成对应的主机名)
# pv
cat >> blueking-web-pv.yaml << EOF
apiVersion: v1
kind: PersistentVolume
metadata:
  name: blueking-web-pv
  labels:
    app: blueking-web
spec:
  storageClassName: local-storage
  capacity:
    storage: 10Gi
  volumeMode: Filesystem
  accessModes:
    - ReadWriteOnce
  persistentVolumeReclaimPolicy: Retain
  local:
    path: /data/bcs/localpv/volblueking-web
  nodeAffinity:
    required:
      nodeSelectorTerms:
        - matchExpressions:
            - key: kubernetes.io/hostname
              operator: In
              values:
                - k8s-master01
  claimRef:
    name: blueking-web-pvc
    namespace: blueking
EOF

# pvc
cat >> blueking-web-pvc.yaml << EOF
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: blueking-web-pvc
  namespace: blueking
spec:
  storageClassName: local-storage
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 10Gi
  selector:
    matchLabels:
      app: blueking-web
EOF

# kubectl创建pv和pvc,先创建pv再建pvc，删除则先删pvc再删pv
kubectl apply -f blueking-web-pv.yaml
kubectl apply -f blueking-web-pvc.yaml

# 查看有没有成功绑定
[root@k8s-master01 blueking]# kubectl get pv |grep blueking-web
blueking-web-pv                            10Gi       RWO            Retain           Bound       blueking/blueking-web-pvc                                 local-storage                  101s
[root@k8s-master01 blueking]# kubectl get pvc |grep blueking-web
blueking-web-pvc                         Bound    blueking-web-pv                            10Gi       RWO            local-storage         105s


# 把刚刚的js复制到挂载的目录
cp /root/bkce7.1-install/tuoming/cmdb-js/app.81251d67f6ed50ee7e18.js /data/bcs/localpv/volblueking-web/

# 增加custom对应pvc指向
cat >> environments/default/bkcmdb-custom-values.yaml.gotmpl << EOF
webserver:
  volumes:
  - name: blueking-web-volume
    persistentVolumeClaim:
      claimName: blueking-web-pvc

  volumeMounts:
  - name: blueking-web-volume
    mountPath: /data/cmdb/cmdb_webserver/web/js/app.81251d67f6ed50ee7e18.js
    subPath: app.81251d67f6ed50ee7e18.js
EOF

# 重新加载cmdb
helmfile -f base-blueking.yaml.gotmpl -l name=bk-user sync

# 加载完成没报错查看cmdbweb有没有挂载到对应的文件
[root@k8s-master01 default]# kubectl describe pod  bk-cmdb-webserver-556cf5fc6-qjz2t -n blueking|grep -i mounts -A 5
    Mounts:
      /data/cmdb/cmdb_webserver/web/js/app.81251d67f6ed50ee7e18.js from cmdb-js-volume (rw,path="app.81251d67f6ed50ee7e18.js")
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-p9wpj (ro)
Conditions:
  Type              Status
  Initialized       True 

# 没问题就去访问cmdb页面，应该是修改成功了，需要先重新加载以下页面，去到cmdb页面用Ctrl+F5去强制刷新即可。
```



### 作业平台

#### 1、底部链接和title

根据需求去修改即可作业平台-->平台管理-->全局设置

![image-20250617171122942](https://raw.githubusercontent.com/XH1994/image-hosting/blueking/image-20250617171122942.png)



#### 2、logo文字修改

修改logo文字需要修改js文件，如果直接在pod修改，那么下次pod重启的时候就会还原回原本的js文件，所以需要执行以下操作，把对应的文件下载下来，修改完之后创建对应的pv和pvc，下次重启让他直接用指定的文件。

```shell
1) job-frontend 默认没有开放挂载，需要手动增加配置
# 修改job的yaml，重新打包。如果charts里不是对应的版本，自己改一下。
mkdir -p /root/bkce7.1-install/tuoming/chart

cd /root/bkce7.1-install/tuoming/chart

tar -zxvf /root/bkce7.1-install/charts/bk-job-0.4.6-rc.1.tgz -C ./

# 修改bk-job/templates/job-frontend/deployment.yaml的文件 大概在78行，修改内容如下：
# volumeMounts和volumes新增了两段if的变量内容。如果看不懂修改了哪里，直接复制这里的内容替换掉即可。

          volumeMounts:
            - name: web-nginx-config
              mountPath: /etc/nginx/
              readOnly: true
            {{- if .Values.extraVolumeMounts }}
            {{- include "common.tplvalues.render" (dict "value" .Values.extraVolumeMounts "context" $) | nindent 12 }}
            {{- end }}
          ports:
            - name: http
              containerPort: 80
              protocol: TCP
          resources:
            {{- toYaml .Values.frontendConfig.resources | nindent 12 }}
      volumes:
        - name: web-nginx-config
          configMap:
            name: {{ include "common.names.fullname" . }}-frontend
        {{- if .Values.extraVolumes }}
        {{- include "common.tplvalues.render" (dict "value" .Values.extraVolumes "context" $) | nindent 8 }}
        {{- end }}

# helm重新打包
helm package bk-job --version=0.4.6-rc.2 -d /root/bkce7.1-install/charts/
 
# 修改对应的部署版本
cd /root/bkce7.1-install/blueking
sed -i 's/bk-job-0.4.6-rc.1.tgz/bk-job-0.4.6-rc.2.tgz/g' base-blueking.yaml.gotmpl
sed -i 's/bk-job: "0.4.6-rc.1"/bk-job: "0.4.6-rc.2"/g' environments/default/version.yaml
# 检查是否修改成功
cat base-blueking.yaml.gotmpl |grep 'bk-job-0.4.6-rc.2.tgz'
cat environments/default/version.yaml|grep bk-job

2）拷贝容器内文件并修改。
# 不同版本可能他的js文件名不一样，不过都是在对应的目录，前缀和后缀都一样的，自己进pod里面查看文件名即可。都是以main.xxxx.js或者app.xxxx.js这样。
mkdir -p /root/bkce7.1-install/tuoming/job-web/

kubectl cp $(kubectl get po |grep bk-job-frontend| awk '{print $1}'):js/main.955c9632a8fe2313d611.js /root/bkce7.1-install/tuoming/job-js/main.955c9632a8fe2313d611.js

sed -i 's/蓝鲸作业平台/作业平台/g' main.955c9632a8fe2313d611.js

3) 复制已修改的内容到pvc挂载的目录里。（如果没有，参考一下cmdb的logo文字修改的内容，先创建对应的pv和pvc）
cp main.955c9632a8fe2313d611.js /data/bcs/localpv/volblueking-web/

4）增加job的custom配置
cat >> environments/default/bkjob-custom-values.yaml.gotmpl << EOF
extraVolumes:
  - name: blueking-web-volume
    persistentVolumeClaim:
      claimName: blueking-web-pvc

extraVolumeMounts:
  - name: blueking-web-volume
    mountPath: /data/job/job-frontend/js/main.955c9632a8fe2313d611.js
    subPath: main.955c9632a8fe2313d611.js
    readOnly: true
EOF

5) 重新加载job
helmfile -f base-blueking.yaml.gotmpl -l name=bk-job sync

6) 加载完成没报错查看bk-job-frontend有没有挂载到对应的文件
kubectl describe pod $(kubectl get pod -n blueking|grep bk-job-frontend|awk '{print $1}') -n blueking |grep -i mounts -A 5

7) 没问题就去访问job页面，应该是修改成功了，需要先重新加载以下页面，去到job页面用Ctrl+F5去强制刷新即可。
```



### 节点管理

#### 修改底部链接、title和logo文字

因为节点管理页面没有提供修改title和底部链接配置，需要把对应的文件下载下来去修改，再用pvc挂载上去。

```shell
1） 拷贝容器内文件并修改
# 不同版本可能他的js文件名不一样，不过都是在对应的目录，前缀和后缀都一样的，自己进pod里面查看文件名即可。都是以main.xxxx.js或者app.xxxx.js这样。
mkdir -p /root/bkce7.1-install/tuoming/nodeman-web

cd /root/bkce7.1-install/tuoming/nodeman-web

kubectl cp -n blueking $(kubectl get po -n blueking |grep bk-nodeman-saas-api| awk '{print $1}'):app/common/context_processors.py ./context_processors.py

kubectl cp -n blueking $(kubectl get po -n blueking |grep bk-nodeman-saas-web| awk '{print $1}'):app/staticfiles/nodeman/css/app.2be322bdf7e2c3d23552.css ./app.2be322bdf7e2c3d23552.css

kubectl cp -n blueking $(kubectl get po -n blueking |grep bk-nodeman-saas-web| awk '{print $1}'):app/staticfiles/nodeman/js/main.7f464f970bbefd18672c.js ./main.7f464f970bbefd18672c.js

# 修改文件内容
sed -i 's/腾讯蓝鲸智云/运维平台/g' context_processors.py
sed -i 's/蓝鲸节点管理/节点管理/g' main.7f464f970bbefd18672c.js
# 底部链接修改比较麻烦，他需要把底部链接这个模块给隐藏掉，具体操作是修改app.2be322bdf7e2c3d23552.css这个文件，将.footer这一段的内容加上display:none，具体如下，在末尾添加了display:none
# 这个自己进去vim修改一下，这个.footer就在前面。修改完这段如下:
.footer[data-v-554ad08a]{position:absolute;bottom:0;left:50%;-webkit-transform:translateX(-50%);transform:translateX(-50%);width:100%;padding:19px 0;text-align:center;display:none}


2）复制已修改的内容到pvc挂载的目录里。（如果没有，参考一下cmdb的logo文字修改的内容，先创建对应的pv和pvc）
cp /root/bkce7.1-install/tuoming/nodeman-web/* /data/bcs/localpv/volblueking-web/

3）增加nodeman的custom配置
cd /root/bkce7.1-install/blueking

cat >> environments/default/bknodeman-custom-values.yaml.gotmpl << EOF
extraVolumes:
  - name: blueking-web-volume
    persistentVolumeClaim:
      claimName: blueking-web-pvc

saas:
  web:
    extraVolumeMounts:
      - name: blueking-web-volume
        mountPath: /app/staticfiles/nodeman/js/main.7f464f970bbefd18672c.js
        subPath: main.7f464f970bbefd18672c.js
        readOnly: true

      - name: blueking-web-volume
        mountPath: /app/staticfiles/nodeman/css/app.2be322bdf7e2c3d23552.css
        subPath: app.2be322bdf7e2c3d23552.css
        readOnly: true

  api:
    extraVolumeMounts:
      - name: blueking-web-volume
        mountPath: /app/common/context_processors.py
        subPath: context_processors.py
        readOnly: true
EOF

4）因为这个全局挂载原本的saas-api和saas-web的deployment是不支持的，所以我们需要去修改他。
# 找到对应的chart，解压下来去修改deployment。
mkdir -p /root/bkce7.1-install/tuoming/chart
tar -zxvf /root/bkce7.1-install/charts/bk-nodeman-2.4.4.tgz -C ./
# 因为修改的比较多，不好对比，直接备份原本的 然后新增deployment.yaml
cp bk-nodeman/templates/web/deployment.yaml{,.bak-$(date +%F)}
cp bk-nodeman/templates/saas-api/deployment.yaml{,.bak-$(date +%F)}

# vim把下面内容复制添加进对应文件  web的deployment.yaml
vim bk-nodeman/templates/web/deployment.yaml 

{{- if and .Values.saas.enabled .Values.saas.web.enabled -}}
{{- $moduleConf := .Values.saas.web -}}
{{- $svcPort := $moduleConf.service.port | default 80 -}}
{{- $fullName := ( include "bk-nodeman.saas-web.fullname" .) -}}
apiVersion: apps/v1
kind: Deployment
metadata:
  name: "{{ $fullName }}"
  labels:
    {{- include "bk-nodeman.labels" . | nindent 4 }}
    {{- if .Values.commonLabels }}
    {{- include "common.tplvalues.render" (dict "value" .Values.commonLabels "context" $) | nindent 4 }}
    {{- end }}
  {{- with .Values.commonAnnotations }}
  annotations:
    {{- toYaml . | nindent 4 }}
  {{- end }}
spec:
  {{- if not .Values.autoscaling.enabled }}
  replicas: {{ $moduleConf.replicaCount }}
  {{- end }}
  selector:
    matchLabels:
      {{- include "bk-nodeman.selectorLabels" . | nindent 6 }}
      app.kubernetes.io/component: "{{ $fullName }}"
  template:
    metadata:
      {{- with .Values.podAnnotations }}
      annotations:
        {{- toYaml . | nindent 8 }}
      {{- end }}
      labels:
        {{- include "bk-nodeman.selectorLabels" . | nindent 8 }}
        app.kubernetes.io/component: "{{ $fullName }}"
    spec:
      {{- with .Values.global.imagePullSecrets }}
      imagePullSecrets:
        {{- toYaml . | nindent 8 }}
      {{- end }}
      serviceAccountName: {{ include "bk-nodeman.serviceAccountName" . }}
      securityContext:
        {{- toYaml .Values.podSecurityContext | nindent 8 }}
      volumes:
        {{- include "bk-nodeman.volumes" . | nindent 8 }}
        - name: static
          emptyDir: {}
        - name: nginx-conf
          configMap:
            name: "{{ include "bk-nodeman.saas-web.fullname" . }}-nginx-configmap"
        {{- if .Values.extraVolumes }}
        {{- toYaml .Values.extraVolumes | nindent 8 }}
        {{- end }}
        {{- if $moduleConf.extraVolumes }}
        {{- toYaml $moduleConf.extraVolumes | nindent 8 }}
        {{- end }}

      initContainers:
        - name: "{{ include "bk-nodeman.migrate-job.db.pure" . }}"
          image: "{{ .Values.global.imageRegistry | default .Values.images.k8sWaitFor.registry }}/{{ .Values.images.k8sWaitFor.repository }}:{{ .Values.images.k8sWaitFor.tag }}"
          imagePullPolicy: "{{ .Values.images.k8sWaitFor.pullPolicy }}"
          args: ["job", "{{ include "bk-nodeman.migrate-job.db" . }}"]
        - name: "{{ $fullName }}-collectstatic"
          image: "{{ .Values.global.imageRegistry | default .Values.images.saas.registry }}/{{ .Values.images.saas.repository }}:{{ .Values.images.saas.tag | default .Chart.AppVersion }}"
          imagePullPolicy: "{{ .Values.images.saas.pullPolicy }}"
          command: ["bash", "-c"]
          args:
            - "python manage.py collectstatic --noinput"
          volumeMounts:
            {{- include "bk-nodeman.volumeMounts" . | nindent 12 }}
            - name: "static"
              mountPath: "/app/staticfiles/"
            {{- if .Values.extraVolumeMounts }}
            {{- toYaml .Values.extraVolumeMounts | nindent 12 }}
            {{- end }}
            {{- if $moduleConf.extraVolumeMounts }}
            {{- toYaml $moduleConf.extraVolumeMounts | nindent 12 }}
            {{- end }}
          {{- include "bk-nodeman.saas.env" . | nindent 10 }}
      
      containers:
        - name: "{{ $fullName }}"
          securityContext:
            {{- toYaml .Values.securityContext | nindent 12 }}
          image: "{{ .Values.global.imageRegistry | default .Values.images.nginx.registry }}/{{ .Values.images.nginx.repository }}:{{ .Values.images.nginx.tag }}"
          imagePullPolicy: "{{ .Values.images.nginx.pullPolicy }}"
          volumeMounts:
            {{- include "bk-nodeman.volumeMounts" . | nindent 12 }}
            - name: "nginx-conf"
              mountPath: "/etc/nginx/conf.d/"
            - name: "static"
              mountPath: "/app/staticfiles/"
            {{- if .Values.extraVolumeMounts }}
            {{- toYaml .Values.extraVolumeMounts | nindent 12 }}
            {{- end }}
            {{- if $moduleConf.extraVolumeMounts }}
            {{- toYaml $moduleConf.extraVolumeMounts | nindent 12 }}
            {{- end }}
          ports:
            - name: http
              containerPort: {{ $svcPort }}
              protocol: TCP
          livenessProbe:
            httpGet:
              path: /static/index.html
              port: {{ $svcPort }}
          readinessProbe:
            httpGet:
              path: /static/index.html
              port: {{ $svcPort }}
          resources:
            {{- toYaml $moduleConf.resources | nindent 12 }}
      {{- with .Values.nodeSelector }}
      nodeSelector:
        {{- toYaml . | nindent 8 }}
      {{- end }}
      {{- with .Values.affinity }}
      affinity:
        {{- toYaml . | nindent 8 }}
      {{- end }}
      {{- with .Values.tolerations }}
      tolerations:
        {{- toYaml . | nindent 8 }}
      {{- end }}
{{- end -}}

# vim把下面内容复制添加进对应文件  saas-api的deployment.yaml
vim bk-nodeman/templates/saas-api/deployment.yaml

{{- if and .Values.saas.enabled .Values.saas.api.enabled -}}
{{- $moduleConf := .Values.saas.api -}}
{{- $svcPort := $moduleConf.service.port | default 10300 -}}
{{- $fullName := ( include "bk-nodeman.saas-api.fullname" .) -}}
apiVersion: apps/v1
kind: Deployment
metadata:
  name: "{{ $fullName }}"
  labels:
    {{- include "bk-nodeman.labels" . | nindent 4 }}
    {{- if .Values.commonLabels }}
    {{- include "common.tplvalues.render" (dict "value" .Values.commonLabels "context" $) | nindent 4 }}
    {{- end }}
  {{- with .Values.commonAnnotations }}
  annotations:
    {{- toYaml . | nindent 4 }}
  {{- end }}
spec:
  {{- if not .Values.autoscaling.enabled }}
  replicas: {{ $moduleConf.replicaCount | default 1 }}
  {{- end }}
  selector:
    matchLabels:
      {{- include "bk-nodeman.selectorLabels" . | nindent 6 }}
      app.kubernetes.io/component: "{{ $fullName }}"
  template:
    metadata:
      {{- with .Values.podAnnotations }}
      annotations:
        {{- toYaml . | nindent 8 }}
      {{- end }}
      labels:
        {{- include "bk-nodeman.selectorLabels" . | nindent 8 }}
        app.kubernetes.io/component: "{{ $fullName }}"
    spec:
      {{- with .Values.global.imagePullSecrets }}
      imagePullSecrets:
        {{- toYaml . | nindent 8 }}
      {{- end }}
      serviceAccountName: {{ include "bk-nodeman.serviceAccountName" . }}
      securityContext:
        {{- toYaml .Values.podSecurityContext | nindent 8 }}
      
      # ======== 添加对额外卷的支持 ========
      volumes:
        {{- include "bk-nodeman.volumes" . | nindent 8 }}
        
        {{- if $moduleConf.extraVolumes }}
        # 组件级额外卷支持
        {{- toYaml $moduleConf.extraVolumes | nindent 8 }}
        {{- end }}
        
        {{- if .Values.extraVolumes }}
        # 全局额外卷支持
        {{- toYaml .Values.extraVolumes | nindent 8 }}
        {{- end }}
      
      initContainers:
        - name: "{{ include "bk-nodeman.migrate-job.db.pure" . }}"
          image: "{{ .Values.global.imageRegistry | default .Values.images.k8sWaitFor.registry }}/{{ .Values.images.k8sWaitFor.repository }}:{{ .Values.images.k8sWaitFor.tag }}"
          imagePullPolicy: "{{ .Values.images.k8sWaitFor.pullPolicy }}"
          args: ["job", "{{ include "bk-nodeman.migrate-job.db" . }}"]
      
      containers:
        - name: {{ $fullName }}
          securityContext:
            {{- toYaml .Values.securityContext | nindent 12 }}
          image: "{{ .Values.global.imageRegistry | default .Values.images.saas.registry }}/{{ .Values.images.saas.repository }}:{{ .Values.images.saas.tag | default .Chart.AppVersion }}"
          imagePullPolicy: "{{ .Values.images.saas.pullPolicy }}"
          command: ["/bin/bash", "-c"]
          args:
            {{- if $moduleConf.command }}
            - "{{ $moduleConf.command }}"
            {{- else }}
            - "bin/hooks/start_cmds/start-saas-api"
            {{- end }}
          
          # ======== 添加对额外挂载点的支持 ========
          volumeMounts:
            {{- include "bk-nodeman.volumeMounts" . | nindent 12 }}
            
            {{- if $moduleConf.extraVolumeMounts }}
            # 组件级额外卷挂载点
            {{- toYaml $moduleConf.extraVolumeMounts | nindent 12 }}
            {{- end }}
            
            {{- if .Values.extraVolumeMounts }}
            # 全局额外卷挂载点
            {{- toYaml .Values.extraVolumeMounts | nindent 12 }}
            {{- end }}
          
          {{- include "bk-nodeman.saas.env" . | nindent 10 }}
          ports:
            - name: http
              containerPort: {{ $svcPort }}
              protocol: TCP
          livenessProbe:
            httpGet:
              path: /version
              port: {{ $svcPort }}
            initialDelaySeconds: 60
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 10
            successThreshold: 1
          readinessProbe:
            httpGet:
              path: /version
              port: {{ $svcPort }}
            initialDelaySeconds: 60
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 15
            successThreshold: 1
          resources:
            {{- toYaml $moduleConf.resources | nindent 12 }}
      
      {{- with .Values.nodeSelector }}
      nodeSelector:
        {{- toYaml . | nindent 8 }}
      {{- end }}
      {{- with .Values.affinity }}
      affinity:
        {{- toYaml . | nindent 8 }}
      {{- end }}
      {{- with .Values.tolerations }}
      tolerations:
        {{- toYaml . | nindent 8 }}
      {{- end }}
{{- end -}}

5）打包并重新sync nodeman服务。
# 打包
helm package bk-nodeman --version=2.4.4 -d /root/bkce7.1-install/charts/

# sync nodeman
cd /root/bkce7.1-install/blueking/
helmfile -f base-blueking.yaml.gotmpl -l name=bk-nodeman sync

6) 加载完成没报错查看nodeman-saas-api和nodeman-saas-web有没有挂载到对应的文件
kubectl describe pod $(kubectl get pod -n blueking|grep nodeman-saas-api|awk '{print $1}') -n blueking |grep -i mounts -A 5

kubectl describe pod $(kubectl get pod -n blueking|grep nodeman-saas-web|awk '{print $1}') -n blueking |grep -i mounts -A 5

7) 没问题就去访问节点管理页面，应该是修改成功了，需要先重新加载以下页面，去到节点管理页面用Ctrl+F5去强制刷新即可。
```



### 用户管理

#### 修改底部链接、title和logo文字

因为用户管理页面没有提供修改title和底部链接配置，需要把对应的文件下载下来去修改，再用pvc挂载上去。

```shell
1） 拷贝容器内文件并修改
# 不同版本可能他的js文件名不一样，不过都是在对应的目录，前缀和后缀都一样的，自己进pod里面查看文件名即可。都是以main.xxxx.js或者app.xxxx.js这样。
mkdir -p /root/bkce7.1-install/tuoming/usermanage-web

cd /root/bkce7.1-install/tuoming/usermanage-web

kubectl cp -n blueking $(kubectl get po -n blueking | grep -v Completed| grep user-saas| awk '{print $1}'):/app/static/js/main.e97784a51255c3873014.js main.e97784a51255c3873014.js

kubectl cp -n blueking $(kubectl get po -n blueking | grep -v Completed| grep user-saas| awk '{print $1}'):/app/bkuser_shell/common/context_processors.py context_processors.py

kubectl cp -n blueking $(kubectl get po -n blueking | grep -v Completed| grep bk-user-api-web| awk '{print $1}'):/app/bkuser_core/config/common/system.py system.py

# 修改文件内容：
sed -i 's/蓝鲸用户管理/用户管理/g' main.e97784a51255c3873014.js

sed -i 's/Tencent BlueKing/用户管理/g' main.e97784a51255c3873014.js

sed -i 's/腾讯蓝鲸智云/运维平台/g' context_processors.py

sed -i '/FOOTER_CONFIG = {/,/^}/ {
    /"text":/ s/:\s*"[^"]*"/: ""/
    /"link":/ s/:\s*"[^"]*"/: ""/
}' system.py

2）复制已修改的内容到pvc挂载的目录里。（如果没有，参考一下cmdb的logo文字修改的内容，先创建对应的pv和pvc）
cp main.e97784a51255c3873014.js /data/bcs/localpv/volblueking-web/user-saas_main.e97784a51255c3873014.js

cp context_processors.py /data/bcs/localpv/volblueking-web/user-saas_context_processors.py

cp system.py /data/bcs/localpv/volblueking-web/user-api_system.py

3）修改bk-user charts包里saas和api-web的deployment
cd /root/bkce7.1-install/tuoming/chart

tar -zxvf /root/bkce7.1-install/charts/bk-user-1.4.14-beta.10.tgz -C ./

# 备份原来的deployment
mv bk-user/charts/saas/templates/deployment.yaml{,.bak-$(date +%F)}
mv bk-user/charts/api/templates/web-deployment.yaml{,.bak-$(date +%F)}
 
# vim把下面的内容添加进新的 deployment.yaml 和 web-deployment.yaml，需要注意的是上面的文件名如果不一样需要自己修改一下的。
vim bk-user/charts/saas/templates/deployment.yaml # 把下面内容贴进去即可，main.xxx.js不一样的话自己修改一下

apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "bk-user.fullname" . }}
  labels:
    {{- include "bk-user.labels" . | nindent 4 }}
spec:
  {{- if not .Values.autoscaling.enabled }}
  replicas: {{ .Values.replicaCount }}
  {{- end }}
  selector:
    matchLabels:
      {{- include "bk-user.selectorLabels" . | nindent 6 }}
  template:
    metadata:
      {{- with .Values.podAnnotations }}
      annotations:
        {{- toYaml . | nindent 8 }}
      {{- end }}
      labels:
        {{- include "bk-user.selectorLabels" . | nindent 8 }}
    spec:
      {{- with .Values.global.imagePullSecrets }}
      imagePullSecrets:
        {{- toYaml . | nindent 8 }}
      {{- end }}
      serviceAccountName: bk-user-saas
      {{- with .Values.global.hostAliases }}
      hostAliases:
        {{- toYaml . | nindent 8 }}
      {{- end }}
      securityContext:
        {{- toYaml .Values.podSecurityContext | nindent 8 }}
      # ======== 新增挂载卷 ========
      volumes:
        - name: blueking-web-volume
          persistentVolumeClaim:
            claimName: blueking-web-pvc
      initContainers:
        - name: check-migrate-db
          image: "{{ .Values.global.imageRegistry | default .Values.migration.images.k8sWaitFor.registry }}/{{ .Values.migration.images.k8sWaitFor.repository }}:{{ .Values.migration.images.k8sWaitFor.tag }}"
          imagePullPolicy: IfNotPresent
          resources: {{- toYaml .Values.migration.resources | nindent 12 }}
          args:
            - job
            - "bk-user-saas-migrate-db-{{ .Release.Revision }}"
      containers:
        - name: {{ .Chart.Name }}
          securityContext:
            {{- toYaml .Values.securityContext | nindent 12 }}
          image: "{{ .Values.global.imageRegistry | default .Values.image.registry }}/{{ .Values.image.repository }}:{{ .Values.image.tag | default .Chart.AppVersion }}"
          {{- with .Values.command }}
          command:
            {{- toYaml . | nindent 12 }}
          {{- end }}
          {{- with .Values.args }}
          args:
            {{- toYaml . | nindent 12 }}
          {{- end }}
          imagePullPolicy: {{ .Values.image.pullPolicy }}
          {{- with .Values.env }}
          env:
            {{- toYaml . | nindent 12 }}
          {{- end }}
          {{- with .Values.envFrom }}
          envFrom:
            {{- toYaml . | nindent 12 }}
          {{- end }}
          ports:
            - name: http
              containerPort: 8000
              protocol: TCP
          # ======== 新增挂载点 ========
          volumeMounts:
            - name: blueking-web-volume
              mountPath: /app/static/js/main.e97784a51255c3873014.js
              subPath: user-saas_main.e97784a51255c3873014.js
              readOnly: true
            - name: blueking-web-volume
              mountPath: /app/bkuser_shell/common/context_processors.py
              subPath: user-saas_context_processors.py
              readOnly: true
          livenessProbe:
            httpGet:
              path: /ping/
              port: http
          readinessProbe:
            httpGet:
              path: /ping/
              port: http
          resources:
            {{- toYaml .Values.resources | nindent 12 }}
      {{- with .Values.nodeSelector }}
      nodeSelector:
        {{- toYaml . | nindent 8 }}
      {{- end }}
      {{- with .Values.affinity }}
      affinity:
        {{- toYaml . | nindent 8 }}
      {{- end }}
      {{- with .Values.tolerations }}
      tolerations:
        {{- toYaml . | nindent 8 }}
      {{- end }}

-----------------------------------------------------------------------------------------

vim bk-user/charts/api/templates/web-deployment.yaml # 把下面内容贴进去即可。

apiVersion: apps/v1
kind: Deployment
metadata:
  name: bk-user-api-web
  labels:
    {{- include "bk-user.labels" . | nindent 4 }}
spec:
  {{- if not .Values.autoscaling.enabled }}
  replicas: {{ .Values.replicaCount }}
  {{- end }}
  selector:
    matchLabels:
      {{- include "bk-user.selectorLabels" . | nindent 6 }}
  template:
    metadata:
      {{- with .Values.podAnnotations }}
      annotations:
        {{- toYaml . | nindent 8 }}
      {{- end }}
      labels:
        {{- include "bk-user.selectorLabels" . | nindent 8 }}
    spec:
      {{- with .Values.global.imagePullSecrets }}
      image极PullSecrets:
        {{- toYaml . | nindent 8 }}
      {{- end }}
      serviceAccountName: bk-user-api
      {{- with .Values.global.hostAliases }}
      hostAliases:
        {{- toYaml . | nindent 8 }}
      {{- end }}
      securityContext:
        {{- toYaml .Values.podSecurityContext | nindent 8 }}
      # ======== 新增挂载卷 ========
      volumes:
        - name: blueking-web-volume
          persistentVolumeClaim:
            claimName: blueking-web-pvc
      initContainers:
        - name: check-migrate-db
          image: "{{ .Values.global.imageRegistry | default .Values.migration.images.k8sWaitFor.registry }}/{{ .Values.migration.images.k8sWaitFor.repository }}:{{ .Values.migration.images.k8sWaitFor.tag }}"
          imagePullPolicy: IfNotPresent
          resources: {{- toYaml .Values.migration.resources | nindent 12 }}
          args:
            - job
            - "bk-user-api-migrate-db-{{ .Release.Revision }}"
      containers:
        - name: {{ .Chart.Name }}
          securityContext:
            {{- toYaml .Values.securityContext | nindent 12 }}
          image: "{{ .Values.global.imageRegistry | default .Values.image.registry }}/{{ .Values.image.repository }}:{{ .Values.image.tag | default .Chart.AppVersion }}"
          imagePullPolicy: {{ .Values.image.pullPolicy }}
          command:
            - bash
          args:
            - /app/start.sh
          # ======== 新增挂载点 ========
          volumeMounts:
            - name: blueking-web-volume
              mountPath: /app/bkuser_core/config/common/system.py
              subPath: user-api_system.py
              readOnly: true
          {{- with .Values.env }}
          env:
            {{- toYaml . | nindent 12 }}
          {{- end }}
          {{- with .Values.envFrom }}
          envFrom:
            {{- toYaml . | nindent 12 }}
          {{- end }}
          ports:
            - name: http
              containerPort: 8000
              protocol: TCP
          livenessProbe:
            httpGet:
              path: /ping/
              port: http
          readinessProbe:
            httpGet:
              path: /ping/
              port: http
          resources:
            {{- toYaml .Values.resources.web | nindent 12 }}
      {{- with .Values.nodeSelector }}
      nodeSelector:
        {{- toYaml . | nindent 8 }}
      {{- end }}
      {{- with .Values.affinity }}
      affinity:
        {{- toYaml . | nindent 8 }}
      {{- end }}
      {{- with .Values.tolerations }}
      tolerations:
        {{- toYaml . | nindent 8 }}
      {{- end }}

-----------------------------------------------------------------------------------------

4）把bk-user重新打包并sync
# 备份原来的bk-user包
mv /root/bkce7.1-install/charts/bk-user-1.4.14-beta.10.tgz{,.bak-$(date +%F)}
# 打包新的bk-user包到/root/bkce7.1-install/charts/目录
helm package bk-user --version=1.4.14-beta.10 -d /root/bkce7.1-install/charts/
# 重新sync bk-user
cd /root/bkce7.1-install/blueking
helmfile -f base-blueking.yaml.gotmpl -l name=bk-user sync

5）上面sync执行结束没报错检查一下有没有成功挂载
kubectl describe pod $(kubectl get po -n blueking | grep -v Completed| grep user-saas| awk '{print $1}') -n blueking |grep -i mounts -A 5

kubectl describe pod $(kubectl get po -n blueking | grep -v Completed| grep user-api-web| awk '{print $1}') -n blueking |grep -i mounts -A 5

6) 没问题就去访问用户管理页面，应该是修改成功了，需要先重新加载以下页面，去到用户管理页面用Ctrl+F5去强制刷新即可。
```



### 制品库

#### 修改title

制品库这个只有title需要修改，其他地方都不带蓝鲸或者腾讯字眼，这里就不去进行修改了

```shell
1） 拷贝容器内文件并修改
# 不同版本可能他的js文件名不一样，不过都是在对应的目录，前缀和后缀都一样的，自己进pod里面查看文件名即可。都是以main.xxxx.js或者app.xxxx.js这样。
mkdir -p /root/bkce7.1-install/tuoming/bk-repo-web

cd /root/bkce7.1-install/tuoming/bk-repo-web

kubectl cp $(kubectl get po |grep bk-repo-bkrepo-gateway| awk '{print $1}'):/data/workspace/frontend/ui/repository.1f7c17b573caad1f839e.min.js repository.1f7c17b573caad1f839e.min.js

2）修改文件内容
sed -i 's/腾讯蓝鲸智云/运维平台/g' repository.1f7c17b573caad1f839e.min.js
sed -i 's/Tencent BlueKing/运维平台/g' repository.1f7c17b573caad1f839e.min.js

3）复制已修改的内容到pvc挂载的目录里。（如果没有，参考一下cmdb的logo文字修改的内容，先创建对应的pv和pvc）
cp repository.1f7c17b573caad1f839e.min.js /data/bcs/localpv/volblueking-web/bk-repo_repository.1f7c17b573caad1f839e.min.js

4）bkrepo-gateway 默认没有开放挂载，需要手动增加配置，修改对应的deployment
mkdir -p /root/bkce7.1-install/tuoming/chart

cd /root/bkce7.1-install/tuoming/chart

tar -zxvf /root/bkce7.1-install/charts/bkrepo-1.3.16-beta.4.tgz -C ./

vim bkrepo/templates/gateway/deployment.yaml # 在bkrepo/templates/gateway/deployment.yaml文件的末尾添加以下内容：
      {{- if .Values.extraVolumeMounts }}
      {{- "\n" }}{{- print "volumeMounts:" | indent 10 }}
      {{- include "common.tplvalues.render" (dict "value" .Values.extraVolumeMounts "context" $) | nindent 12 }}
      {{- end }}
      {{- if .Values.extraVolumes }}
      {{- "\n" }}{{- print "volumes:" | indent 6 }}
      {{- include "common.tplvalues.render" (dict "value" .Values.extraVolumes "context" $) | nindent 8 }}
      {{- end }}

5）打包新的bkrepo包
mv /root/bkce7.1-install/charts/bkrepo-1.3.16-beta.4.tgz{,.bak-$(date +%F)}

helm package bkrepo --version=1.3.16-beta.4 -d /root/bkce7.1-install/charts/

6）增加bkrepo的custom配置
cd /root/bkce7.1-install/blueking


cat >> environments/default/bkrepo-custom-values.yaml.gotmpl << EOF
extraVolumes:
  - name: blueking-web-volume
    persistentVolumeClaim:
      claimName: blueking-web-pvc

extraVolumeMounts:
  - name: blueking-web-volume
    mountPath: /data/workspace/frontend/ui/repository.1f7c17b573caad1f839e.min.js
    subPath: bk-repo_repository.1f7c17b573caad1f839e.min.js
    readOnly: true
EOF

7）重新sync bk-repo
helmfile -f base-blueking.yaml.gotmpl -l name=bk-repo sync

8）上面sync执行结束没报错检查一下有没有成功挂载
kubectl describe pod $(kubectl get po -n blueking | grep bk-repo-bkrepo-gateway | awk '{print $1}') -n blueking |grep -i mounts -A 5

6) 没问题就去访问制品库页面，应该是修改成功了，需要先重新加载以下页面，去到制品库页面用Ctrl+F5去强制刷新即可。
```



### 权限中心

#### 修改title和logo文字

```shell
1） 拷贝容器内文件并修改
# 不同版本可能他的js文件名不一样，不过都是在对应的目录，前缀和后缀都一样的，自己进pod里面查看文件名即可。都是以main.xxxx.js或者app.xxxx.js这样。
mkdir -p /root/bkce7.1-install/tuoming/bk-iam-web

cd /root/bkce7.1-install/tuoming/bk-iam-web

kubectl cp -n blueking $(kubectl get po -n blueking |grep iam-saas-web| awk '{print $1}'):/app/staticfiles/js/ee.618eb754abc7b7c3ebf2.js ee.618eb754abc7b7c3ebf2.js

kubectl cp -n blueking $(kubectl get po -n blueking |grep iam-saas-web| awk '{print $1}'):/app/resources/templates/index.html index.html

2）修改文件内容
sed -i 's/腾讯蓝鲸智云/运维平台/g' index.html
sed -i 's/Tencent Blueking/运维平台/g' index.html
sed -i 's/蓝鲸权限中心/权限中心/g' ee.618eb754abc7b7c3ebf2.js

3）复制已修改的内容到pvc挂载的目录里。（如果没有，参考一下cmdb的logo文字修改的内容，先创建对应的pv和pvc）
cp index.html /data/bcs/localpv/volblueking-web/iam-web_index.html
cp ee.618eb754abc7b7c3ebf2.js /data/bcs/localpv/volblueking-web/iam-web_ee.618eb754abc7b7c3ebf2.js

4）增加custom配置
cd /root/bkce7.1-install/blueking/

cat >> environments/default/bkiam-saas-custom-values.yaml.gotmpl << EOF
extraVolumes:
  - name: blueking-web-volume
    persistentVolumeClaim:
      claimName: blueking-web-pvc

extraVolumeMounts:
  - name: blueking-web-volume
    mountPath: /app/staticfiles/js/ee.618eb754abc7b7c3ebf2.js
    subPath: iam-web_ee.618eb754abc7b7c3ebf2.js
    readOnly: true

  - name: blueking-web-volume
    mountPath: /app/resources/templates/index.html
    subPath: iam-web_index.html
    readOnly: true
EOF

5）重新sync bk-repo
helmfile -f base-blueking.yaml.gotmpl -l name=bk-iam-saas sync

6）上面sync执行结束没报错检查一下有没有成功挂载
kubectl describe pod $(kubectl get po -n blueking | grep bkiam-saas-web | awk '{print $1}') -n blueking |grep -i mounts -A 5

7) 没问题就去访问权限中心页面，应该是修改成功了，需要先重新加载以下页面，去到权限中心页面用Ctrl+F5去强制刷新即可。
```



### 日志平台

#### 修改title

日志平台这个只有title需要修改，其他地方都不带蓝鲸或者腾讯字眼，这里就不去进行修改了

```shell
1） 拷贝容器内文件并修改
# 不同版本可能他的js文件名不一样，不过都是在对应的目录，前缀和后缀都一样的，自己进pod里面查看文件名即可。都是以main.xxxx.js或者app.xxxx.js这样。
mkdir -p /root/bkce7.1-install/tuoming/log-search-web

cd /root/bkce7.1-install/tuoming/log-search-web

kubectl cp -n blueking $(kubectl get po -n blueking |grep bk-log-search-web| grep -v beat | grep -v worker|awk '{print $1}'):/app/code/static/dist/js/main.e5a4d978ace403d747a4.js main.e5a4d978ace403d747a4.js

kubectl cp -n blueking $(kubectl get po -n blueking |grep bk-log-search-web| grep -v beat | grep -v worker|awk '{print $1}'):/app/code/dev.env.yml dev.env.yml

kubectl cp -n blueking $(kubectl get po -n blueking |grep bk-log-search-web| grep -v beat | grep -v worker|awk '{print $1}'):/app/code/prod.env.yml prod.env.yml

kubectl cp -n blueking $(kubectl get po -n blueking |grep bk-log-search-web| grep -v beat | grep -v worker|awk '{print $1}'):/app/code/stag.env.yml stag.env.yml

2）修改文件内容
sed -i 's/腾讯蓝鲸智云/运维平台/g' ./*

3）复制已修改的内容到pvc挂载的目录里。（如果没有，参考一下cmdb的logo文字修改的内容，先创建对应的pv和pvc）
cp dev.env.yml /data/bcs/localpv/volblueking-web/log-search-web_dev.env.yml
cp prod.env.yml /data/bcs/localpv/volblueking-web/log-search-web_prod.env.yml
cp stag.env.yml /data/bcs/localpv/volblueking-web/log-search-web_stag.env.yml
cp main.e5a4d978ace403d747a4.js /data/bcs/localpv/volblueking-web/log-search-web_main.e5a4d978ace403d747a4.js

4）bk-log-search-web 默认没有开放挂载，需要手动增加配置，修改对应的deployment
mkdir -p /root/bkce7.1-install/tuoming/chart
cd /root/bkce7.1-install/tuoming/chart
# 包如果不存在/root/bkce7.1-install/charts/里面，那就再root的.cache里面
tar -zxvf /root/.cache/helm/repository/bk-log-search-4.6.6.tgz -C ./

vim bk-log-search/templates/deployments/web.yaml # 在bk-log-search/templates/deployments/web.yaml文件的末尾添加以下内容：
      {{- if .Values.extraVolumeMounts }}
      {{- "\n" }}{{- print "volumeMounts:" | indent 10 }}
      {{- include "common.tplvalues.render" (dict "value" .Values.extraVolumeMounts "context" $) | nindent 12 }}
      {{- end }}
      {{- if .Values.extraVolumes }}
      {{- "\n" }}{{- print "volumes:" | indent 6 }}
      {{- include "common.tplvalues.render" (dict "value" .Values.extraVolumes "context" $) | nindent 8 }}
      {{- end }}

5）打包新的bk-log-search包
# 如果安装包在/root/bkce7.1-install/charts里 则执行mv命令，不在则不需要执行
mv /root/bkce7.1-install/charts/bk-log-search-4.6.6.tgz{,.bak-$(date +%F)}
# 把修改完的bk-log-search打包到/root/bkce7.1-install/charts/
helm package bk-log-search --version=4.6.6 -d /root/bkce7.1-install/charts/
# 如果是在线安装的，还需要修改04-bklog-search.yaml.gotmpl文件里chart指定位置，如果不是，这命令不用执行修改。
sed -i 's#blueking/bk-log-search#/root/bkce7.1-install/charts/bk-log-search-4.6.6.tgz#g' /root/bkce7.1-install/blueking/04-bklog-search.yaml.gotmpl

6）增加custom配置
cd /root/bkce7.1-install/blueking/

cat >> environments/default/bklog-search-custom-values.yaml.gotmpl << EOF
extraVolumes:
  - name: blueking-web-volume
    persistentVolumeClaim:
      claimName: blueking-web-pvc

extraVolumeMounts:
  - name: blueking-web-volume
    mountPath: /app/code/static/dist/js/main.e5a4d978ace403d747a4.js
    subPath: log-search-web_main.e5a4d978ace403d747a4.js
    readOnly: true

  - name: blueking-web-volume
    mountPath: /app/code/dev.env.yml
    subPath: log-search-web_dev.env.yml
    readOnly: true

  - name: blueking-web-volume
    mountPath: /app/code/prod.env.yml
    subPath: log-search-web_prod.env.yml
    readOnly: true

  - name: blueking-web-volume
    mountPath: /app/code/stag.env.yml
    subPath: log-search-web_stag.env.yml
    readOnly: true
EOF

7）重新sync bklog-search
helmfile -f 04-bklog-search.yaml.gotmpl sync 

8）上面sync执行结束没报错检查一下有没有成功挂载
kubectl describe pod $(kubectl get po -n blueking | grep log-search-web|grep -v beat|grep -v worker | awk '{print $1}') -n blueking |grep -i mounts -A 5

9) 没问题就去访问日志平台页面，应该是修改成功了，需要先重新加载以下页面，去到日志平台页面用Ctrl+F5去强制刷新即可。
```



### 监控平台&故障治愈

因为fta(故障治愈)现在整合到了监控平台里，所以在这里一起修改了。fta只需要修改title

#### 修改title和底部链接

```shell
1） 拷贝容器内文件并修改
# 不同版本可能他的js文件名不一样，不过都是在对应的目录，前缀和后缀都一样的，自己进pod里面查看文件名即可。都是以main.xxxx.js或者app.xxxx.js这样。
mkdir -p /root/bkce7.1-install/tuoming/bkmonitor-web

cd /root/bkce7.1-install/tuoming/bkmonitor-web

kubectl cp -n blueking $(kubectl get po -n blueking |grep bk-monitor-web| grep -v beat | grep -v worker | grep -v query|awk '{print $1}'):/app/code/packages/monitor_web/commons/html/resources.py resources.py

kubectl cp -n blueking $(kubectl get po -n blueking |grep bk-monitor-web| grep -v beat | grep -v worker | grep -v query|awk '{print $1}'):/app/code/static/monitor/js/main.2dc0447fed9ad9e57bda.js main.2dc0447fed9ad9e57bda.js

kubectl cp -n blueking $(kubectl get po -n blueking |grep bk-monitor-web| grep -v beat | grep -v worker | grep -v query|awk '{print $1}'):/app/code/static/fta/js/main.deeca25fa6afafa6da07.js main.deeca25fa6afafa6da07.js

2）修改文件内容
sed -i 's/腾讯蓝鲸智云/运维平台/g' main.2dc0447fed9ad9e57bda.js
sed -i 's/Tencent BlueKing/运维平台/g' main.2dc0447fed9ad9e57bda.js
sed -i 's/腾讯蓝鲸智云/运维平台/g' main.deeca25fa6afafa6da07.js

sed -i '/FOOTER_TEMPLATE = """/,/"""/ {
    /FOOTER_TEMPLATE/! s/^/#/
    /FOOTER_TEMPLATE/ s/"""/""/
}' resources.py

3）复制已修改的内容到pvc挂载的目录里。（如果没有，参考一下cmdb的logo文字修改的内容，先创建对应的pv和pvc）
cp main.2dc0447fed9ad9e57bda.js /data/bcs/localpv/volblueking-web/bkmonitor-web_main.2dc0447fed9ad9e57bda.js

cp resources.py /data/bcs/localpv/volblueking-web/bkmonitor-web_resources.py

cp main.deeca25fa6afafa6da07.js /data/bcs/localpv/volblueking-web/fta-web_main.deeca25fa6afafa6da07.js

4）bk-monitor-web 默认没有开放挂载，需要手动增加配置，修改对应的deployment
mkdir -p /root/bkce7.1-install/tuoming/chart
cd /root/bkce7.1-install/tuoming/chart
# 包如果不存在/root/bkce7.1-install/charts/里面，那就再root的.cache里面
tar -zxvf /root/bkce7.1-install/charts/bk-monitor-3.8.12.tgz -C ./

vim bk-monitor/charts/monitor/templates/deployments/web.yaml # 在bk-monitor/charts/monitor/templates/deployments/web.yaml文件末尾添加以下内容：
      {{- if .Values.extraVolumeMounts }}
      {{- "\n" }}{{- print "volumeMounts:" | indent 10 }}
      {{- include "common.tplvalues.render" (dict "value" .Values.extraVolumeMounts "context" $) | nindent 12 }}
      {{- end }}
      {{- if .Values.extraVolumes }}
      {{- "\n" }}{{- print "volumes:" | indent 6 }}
      {{- include "common.tplvalues.render" (dict "value" .Values.extraVolumes "context" $) | nindent 8 }}
      {{- end }}

5）打包新的bk-monitor
# 如果安装包在/root/bkce7.1-install/charts里 则执行mv命令，不在则不需要执行
mv /root/bkce7.1-install/charts/bk-monitor-3.8.12.tgz{,.bak-$(date +%F)}
# 把修改完的bk-monitor打包到/root/bkce7.1-install/charts/
helm package bk-monitor --version=3.8.12 -d /root/bkce7.1-install/charts/
# 如果是在线安装的，还需要修改04-bkmonitor.yaml.gotmpl文件里chart指定位置，如果不是，这命令不用执行修改。
sed -i 's#blueking/bkmonitor#/root/bkce7.1-install/charts/bk-monitor-3.8.12.tgz#g' /root/bkce7.1-install/blueking/04-bkmonitor.yaml.gotmpl


6）增加custom配置
cd /root/bkce7.1-install/blueking/

cat >> environments/default/bkmonitor-custom-values.yaml.gotmpl << EOF
monitor:
  extraVolumes:
    - name: blueking-web-volume
      persistentVolumeClaim:
        claimName: blueking-web-pvc
  
  extraVolumeMounts:
    - name: blueking-web-volume
      mountPath: /app/code/packages/monitor_web/commons/html/resources.py
      subPath: bkmonitor-web_resources.py
      readOnly: true
  
    - name: blueking-web-volume
      mountPath: /app/code/static/monitor/js/main.2dc0447fed9ad9e57bda.js
      subPath: bkmonitor-web_main.2dc0447fed9ad9e57bda.js
      readOnly: true
      
    - name: blueking-web-volume
      mountPath: /app/code/static/fta/js/main.deeca25fa6afafa6da07.js
      subPath: fta-web_main.deeca25fa6afafa6da07.js
      readOnly: true
EOF

7）重新sync bkmonitor
helmfile -f 04-bkmonitor.yaml.gotmpl sync

8）上面sync执行结束没报错检查一下有没有成功挂载
kubectl describe pod $(kubectl get po -n blueking | grep bk-monitor-web|grep -v beat|grep -v worker | awk '{print $1}') -n blueking |grep -i mounts -A 5

9) 没问题就去访问监控平台和故障自愈页面，应该是修改成功了，需要先重新加载以下页面，去到监控平台和故障自愈页面用Ctrl+F5去强制刷新即可。
```



### 容器管理平台

#### 修改底部链接、title、logo文字、帮助链接

```shell
1） 拷贝容器内文件并修改
# 不同版本可能他的js文件名不一样，不过都是在对应的目录，前缀和后缀都一样的，自己进pod里面查看文件名即可。都是以main.xxxx.js或者app.xxxx.js这样。
mkdir -p /root/bkce7.1-install/tuoming/bcs-web

cd /root/bkce7.1-install/tuoming/bcs-web

kubectl cp -n bcs-system $(kubectl get po -n bcs-system |grep bcs-services-stack-app|grep -v migrate | awk '{print $1}'):/data/staticfiles/ce/static/js/main.82f1d3a9.b840734ede46.js.gz main.82f1d3a9.b840734ede46.js.gz

kubectl cp -n bcs-system $(kubectl get po -n bcs-system |grep bcs-services-stack-app|grep -v migrate | awk '{print $1}'):/data/staticfiles/ce/static/js/main.82f1d3a9.js.gz main.82f1d3a9.js.gz


kubectl cp -n bcs-system $(kubectl get po -n bcs-system |grep bcs-services-stack-app|grep -v migrate | awk '{print $1}'):/data/staticfiles/ce/static/css/entry.b675ae49.css.gz entry.b675ae49.css.gz

kubectl cp -n bcs-system $(kubectl get po -n bcs-system |grep bcs-services-stack-app|grep -v migrate | awk '{print $1}'):/data/staticfiles/ce/static/css/main.a6109996.2b0a42ec2897.css.gz main.a6109996.2b0a42ec2897.css.gz

kubectl cp -n bcs-system $(kubectl get po -n bcs-system |grep bcs-services-stack-app|grep -v migrate | awk '{print $1}'):/data/staticfiles/ce/static/css/main.a6109996.css.gz main.a6109996.css.gz

2）修改文件内容
# 解压文件
for i in $(ls);do gzip -d $i;done
# 修改title，因为是unicode编码，所以用unicode编码去修改。把腾讯蓝鲸智云改成运维平台
sed -i 's/\\u817E\\u8BAF\\u84DD\\u9CB8\\u667A\\u4E91/\\u8FD0\\u7EF4\\u5E73\\u53F0/g' ./*.js
# 修改logo文字，把蓝鲸容器管理平台改成容器管理平台
sed -i 's/\\u84DD\\u9CB8\\u5BB9\\u5668\\u7BA1\\u7406\\u5E73\\u53F0/\\u5BB9\\u5668\\u7BA1\\u7406\\u5E73\\u53F0/g' ./*.js
# 修改底部链接，需要修改entry.b675ae49.css文件，把.bcs-footer[data-v-7b657b75]屏蔽掉，在他的内容末尾加上display:none,具体如下：  vim进去手动修改，末尾添加上display:none

.bcs-footer[data-v-7b657b75]{color:#b7c0ca;font-size:12px;line-height:20px;padding:25px 15px;text-align:center;width:100%;display:none}

# 修改帮助链接，需要修改main.a6109996.2b0a42ec2897.css和main.a6109996.css两个文件。把.bk-dialog-mask.hide-active内容屏蔽掉，在他内容末尾加上display:none,具体如下：

.bk-dialog-mask.hide-active{-webkit-animation:mask-hidding .4s;animation:mask-hidding .4s;display:none}

# 重新打包文件
for i in $(ls);do gzip $i;done

3）创建pv和pvc到bcs-system的命名空间
# 源目录可以自定义，需要目录所在磁盘有 100GB 以上的空间。此处为了和 bcs.sh 保持一致，使用 /data/bcs/localpv/
src_dir=/data/bcs/localpv/
# pv目录需要和全局 Values 中的 .localpv.hostDir 保持一致
pv_host_dir=/mnt/blueking/
# 创建web所需的目录。
for i in bcs-web; do
  vol="vol$i"
  vol_dir="${pv_host_dir%/}/$vol"
  vol_src="${src_dir%/}/$vol"
  mkdir -p "$vol_dir" "$vol_src";
  if grep -w "$vol_dir" /etc/fstab; then
    echo >&2 "TIP: vol $vol exist in /etc/fstab."
  else
    echo "$vol_src $vol_dir none defaults,bind 0 0" | tee -a /etc/fstab
  fi
done
# 在目录制备完成后，需要mount才能被 localpv provisioner 认可。
mount -va
# 检查挂载结果
grep -w bcs-web /etc/fstab /proc/self/mounts

# 创建bcs-web-pv
cd /root/bkce7.1-install/blueking
cat >> bcs-web-pv.yaml << EOF
apiVersion: v1
kind: PersistentVolume
metadata:
  name: bcs-web-pv
  labels:
    app: bcs-web
spec:
  storageClassName: local-storage
  capacity:
    storage: 10Gi
  volumeMode: Filesystem
  accessModes:
    - ReadWriteOnce
  persistentVolumeReclaimPolicy: Retain
  local:
    path: /data/bcs/localpv/volbcs-web
  nodeAffinity:
    required:
      nodeSelectorTerms:
        - matchExpressions:
            - key: kubernetes.io/hostname
              operator: In
              values:
                - k8s-master01
  claimRef:
    name: bcs-web-pvc
    namespace: bcs-system
EOF

# 创建bcs-web-pvc
cat >> bcs-web-pvc.yaml << EOF
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: bcs-web-pvc
  namespace: bcs-system
spec:
  storageClassName: local-storage
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 10Gi
  selector:
    matchLabels:
      app: bcs-web
EOF

# kubectl创建pv和pvc,先创建pv再建pvc，删除则先删pvc再删pv
kubectl apply -f bcs-web-pv.yaml
kubectl apply -f bcs-web-pvc.yaml

# 查看有没有成功绑定
[root@k8s-master01 blueking]# kubectl get pvc -n bcs-system|grep bcs-web-pvc
bcs-web-pvc                                    Bound     bcs-web-pv          10Gi       RWO            local-storage   18h
[root@k8s-master01 blueking]# kubectl get pv -n bcs-system|grep bcs-web-pv
bcs-web-pv                                 10Gi       RWO            Retain           Bound       bcs-system/bcs-web-pvc                                    local-storage                  18h

4）把刚刚修改完打包好的文件复制到挂载目录
cd /root/bkce7.1-install/tuoming/bcs-web
for i in $(ls);do cp $i /data/bcs/localpv/volbcs-web/bcs-web_$i;done

5）bcs-services-stack-app默认没有开放挂载，需要修改对应的deployments。
mkdir -p /root/bkce7.1-install/tuoming/chart
cd /root/bkce7.1-install/tuoming/chart
# 包如果不存在/root/bkce7.1-install/charts/里面，那就再root的.cache里面
tar -zxvf /root/bkce7.1-install/charts/bcs-services-stack-1.28.2-beta.2.tgz -C ./

# 备份原来的deployments
mv bcs-services-stack/charts/bcs-ui/charts/app/templates/deployment.yaml{,.bak}
# 添加新的deployment.yaml，注意如果挂载的文件名称不一样，需要修改volumeMounts里面的内容，自行修改。
cat >> bcs-services-stack/charts/bcs-ui/charts/app/templates/deployment.yaml << EOF
{{- if .Values.enabled -}}
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "app.fullname" . }}
  labels:
    {{- include "app.labels" . | nindent 4 }}
spec:
  {{- if not .Values.autoscaling.enabled }}
  replicas: {{ .Values.replicaCount }}
  {{- end }}
  selector:
    matchLabels:
      {{- include "app.selectorLabels" . | nindent 6 }}
  template:
    metadata:
      annotations:
        checksum/config: {{ include (print $.Template.BasePath "/clustertools-configmap.yaml") . | sha256sum }}
      labels:
        {{- include "app.selectorLabels" . | nindent 8 }}
    spec:
      {{- include "app.imagePullSecrets" . | trim | nindent 6 }}
      serviceAccountName: {{ include "app.serviceAccountName" . }}
      containers:
        - name: gunicorn
          securityContext:
            {{- toYaml .Values.securityContext | nindent 12 }}
          image: {{ include "app.image" . }}
          imagePullPolicy: {{ .Values.image.pullPolicy }}
          command:
            - /bin/bash
            - -c
          args:
            - gunicorn wsgi --env prometheus_multiproc_dir=/tmp/ -b [::]:28000 -w 8 --timeout 120 --access-logfile - --error-logfile -
          ports:
            - name: http
              containerPort: 28000
              protocol: TCP
          env:
            {{- include "app.envs" . | trim | nindent 12 }}
          envFrom:
            {{- toYaml .Values.envFrom | nindent 12 }}
          resources:
            {{- toYaml .Values.resources | nindent 12 }}
          readinessProbe:
            initialDelaySeconds: 2
            failureThreshold: 3
            periodSeconds: 10
            httpGet:
              path: /api/healthz/
              port: 28000
          livenessProbe:
            initialDelaySeconds: 2
            failureThreshold: 3
            periodSeconds: 10
            tcpSocket:
              port: 28000
          volumeMounts:
          - mountPath: /tmp
            name: prometheus-multiproc-dir
          - name: bcs-web-volume
            mountPath: /data/staticfiles/ce/static/js/main.82f1d3a9.b840734ede46.js.gz
            subPath: bcs-web_main.82f1d3a9.b840734ede46.js.gz
            readOnly: true
          - name: bcs-web-volume
            mountPath: /data/staticfiles/ce/static/js/main.82f1d3a9.js.gz
            subPath: bcs-web_main.82f1d3a9.js.gz
            readOnly: true
          - name: bcs-web-volume
            mountPath: /data/staticfiles/ce/static/css/main.a6109996.2b0a42ec2897.css.gz
            subPath: bcs-web_main.a6109996.2b0a42ec2897.css.gz
            readOnly: true
          - name: bcs-web-volume
            mountPath: /data/staticfiles/ce/static/css/main.a6109996.css.gz
            subPath: bcs-web_main.a6109996.css.gz
            readOnly: true
          - name: bcs-web-volume
            mountPath: /data/staticfiles/ce/static/css/entry.b675ae49.css.gz
            subPath: bcs-web_entry.b675ae49.css.gz
            readOnly: true
        - name: channel
          securityContext:
            {{- toYaml .Values.securityContext | nindent 12 }}
          image: {{ include "app.image" . }}
          imagePullPolicy: {{ .Values.image.pullPolicy }}
          command:
            - /bin/bash
            - -c
          args:
            - gunicorn backend.asgi -b [::]:28801 -w 4 -k uvicorn.workers.UvicornWorker --access-logfile - --error-logfile -
          ports:
            - name: ws-channel
              containerPort: 28801
              protocol: TCP
          env:
            {{- include "app.envs" . | trim | nindent 12 }}
          envFrom:
            {{- toYaml .Values.envFrom | nindent 12 }}
          resources:
            {{- toYaml .Values.resources | nindent 12 }}
          volumeMounts:
          - name: bcs-web-volume
            mountPath: /data/staticfiles/ce/static/js/main.82f1d3a9.b840734ede46.js.gz
            subPath: bcs-web_main.82f1d3a9.b840734ede46.js.gz
            readOnly: true
          - name: bcs-web-volume
            mountPath: /data/staticfiles/ce/static/js/main.82f1d3a9.js.gz
            subPath: bcs-web_main.82f1d3a9.js.gz
            readOnly: true
          - name: bcs-web-volume
            mountPath: /data/staticfiles/ce/static/css/main.a6109996.2b0a42ec2897.css.gz
            subPath: bcs-web_main.a6109996.2b0a42ec2897.css.gz
            readOnly: true
          - name: bcs-web-volume
            mountPath: /data/staticfiles/ce/static/css/main.a6109996.css.gz
            subPath: bcs-web_main.a6109996.css.gz
            readOnly: true
          - name: bcs-web-volume
            mountPath: /data/staticfiles/ce/static/css/entry.b675ae49.css.gz
            subPath: bcs-web_entry.b675ae49.css.gz
            readOnly: true
        - name: web-console
          securityContext:
            {{- toYaml .Values.securityContext | nindent 12 }}
          image: {{ include "app.image" . }}
          imagePullPolicy: {{ .Values.image.pullPolicy }}
          command:
            - /bin/bash
            - -c
          args:
            - python -m backend.web_console
          ports:
            - name: web-console
              containerPort: 28800
              protocol: TCP
          env:
            {{- include "app.envs" . | trim | nindent 12 }}
          envFrom:
            {{- toYaml .Values.envFrom | nindent 12 }}
          resources:
            {{- toYaml .Values.resources | nindent 12 }}
          volumeMounts:
          - name: bcs-web-volume
            mountPath: /data/staticfiles/ce/static/js/main.82f1d3a9.b840734ede46.js.gz
            subPath: bcs-web_main.82f1d3a9.b840734ede46.js.gz
            readOnly: true
          - name: bcs-web-volume
            mountPath: /data/staticfiles/ce/static/js/main.82f1d3a9.js.gz
            subPath: bcs-web_main.82f1d3a9.js.gz
            readOnly: true
          - name: bcs-web-volume
            mountPath: /data/staticfiles/ce/static/css/main.a6109996.2b0a42ec2897.css.gz
            subPath: bcs-web_main.a6109996.2b0a42ec2897.css.gz
            readOnly: true
          - name: bcs-web-volume
            mountPath: /data/staticfiles/ce/static/css/main.a6109996.css.gz
            subPath: bcs-web_main.a6109996.css.gz
            readOnly: true
          - name: bcs-web-volume
            mountPath: /data/staticfiles/ce/static/css/entry.b675ae49.css.gz
            subPath: bcs-web_entry.b675ae49.css.gz
            readOnly: true
        - name: celery-beat
          securityContext:
            {{- toYaml .Values.securityContext | nindent 12 }}
          image: {{ include "app.image" . }}
          imagePullPolicy: {{ .Values.image.pullPolicy }}
          command:
            - /bin/bash
            - -c
          args:
            - celery -A backend.celery_app beat -l info -S django_celery_beat.schedulers:DatabaseScheduler
          env:
            {{- include "app.envs" . | trim | nindent 12 }}
          envFrom:
            {{- toYaml .Values.envFrom | nindent 12 }}
          resources:
            {{- toYaml .Values.resources | nindent 12 }}
          volumeMounts:
          - name: bcs-web-volume
            mountPath: /data/staticfiles/ce/static/js/main.82f1d3a9.b840734ede46.js.gz
            subPath: bcs-web_main.82f1d3a9.b840734ede46.js.gz
            readOnly: true
          - name: bcs-web-volume
            mountPath: /data/staticfiles/ce/static/js/main.82f1d3a9.js.gz
            subPath: bcs-web_main.82f1d3a9.js.gz
            readOnly: true
          - name: bcs-web-volume
            mountPath: /data/staticfiles/ce/static/css/main.a6109996.2b0a42ec2897.css.gz
            subPath: bcs-web_main.a6109996.2b0a42ec2897.css.gz
            readOnly: true
          - name: bcs-web-volume
            mountPath: /data/staticfiles/ce/static/css/main.a6109996.css.gz
            subPath: bcs-web_main.a6109996.css.gz
            readOnly: true
          - name: bcs-web-volume
            mountPath: /data/staticfiles/ce/static/css/entry.b675ae49.css.gz
            subPath: bcs-web_entry.b675ae49.css.gz
            readOnly: true
        - name: celery
          securityContext:
            {{- toYaml .Values.securityContext | nindent 12 }}
          image: {{ include "app.image" . }}
          imagePullPolicy: {{ .Values.image.pullPolicy }}
          command:
            - /bin/bash
            - -c
          args:
            - celery -A backend.celery_app worker -l info
          env:
            {{- include "app.envs" . | trim | nindent 12 }}
          envFrom:
            {{- toYaml .Values.envFrom | nindent 12 }}
          resources:
            {{- toYaml .Values.resources | nindent 12 }}
          volumeMounts:
          - mountPath: /tmp
            name: prometheus-multiproc-dir
          - name: bcs-web-volume
            mountPath: /data/staticfiles/ce/static/js/main.82f1d3a9.b840734ede46.js.gz
            subPath: bcs-web_main.82f1d3a9.b840734ede46.js.gz
            readOnly: true
          - name: bcs-web-volume
            mountPath: /data/staticfiles/ce/static/js/main.82f1d3a9.js.gz
            subPath: bcs-web_main.82f1d3a9.js.gz
            readOnly: true
          - name: bcs-web-volume
            mountPath: /data/staticfiles/ce/static/css/main.a6109996.2b0a42ec2897.css.gz
            subPath: bcs-web_main.a6109996.2b0a42ec2897.css.gz
            readOnly: true
          - name: bcs-web-volume
            mountPath: /data/staticfiles/ce/static/css/main.a6109996.css.gz
            subPath: bcs-web_main.a6109996.css.gz
            readOnly: true
          - name: bcs-web-volume
            mountPath: /data/staticfiles/ce/static/css/entry.b675ae49.css.gz
            subPath: bcs-web_entry.b675ae49.css.gz
            readOnly: true
      initContainers:
        - name: check-migrate-job
          image: {{ include "app.migration.k8sWaitFor.image" . }}
          imagePullPolicy: IfNotPresent
          args:
            - job
            - {{ include "app.migrateJobName" . }}
      {{- with .Values.global.nodeSelector }}
      nodeSelector:
        {{- toYaml . | nindent 8 }}
      {{- end }}
      {{- with .Values.global.affinity }}
      affinity:
        {{- toYaml . | nindent 8 }}
      {{- end }}
      {{- with .Values.global.tolerations }}
      tolerations:
        {{- toYaml . | nindent 8 }}
      {{- end }}
      volumes:
      - name: prometheus-multiproc-dir
        emptyDir: {}
      - name: bcs-web-volume
        persistentVolumeClaim:
          claimName: bcs-web-pvc
{{- end }}
EOF

6）重新打包bcs-services-stack
# 先备份
mv /root/bkce7.1-install/charts/bcs-services-stack-1.28.2-beta.2.tgz{,.bak}
# 打包
helm package bcs-services-stack --version=1.28.2-beta.2 -d /root/bkce7.1-install/charts
# 如果是在线安装的，还需要修改03-bcs.yaml.gotmpl文件里chart指定位置。

7）重新sync bcs-services-stack
helmfile -f 03-bcs.yaml.gotmpl  sync 

8）上面sync执行结束没报错检查一下有没有成功挂载
kubectl describe pod $(kubectl get po -n bcs-system |grep bcs-services-stack-app|grep -v migrate | awk '{print $1}') -n bcs-system |grep -i mounts -A 5

9) 没问题就去访问容器平台页面，应该是修改成功了，需要先重新加载以下页面，去到容器平台页面用Ctrl+F5去强制刷新即可。
```



### 开发者中心

#### 修改title、logo文字、底部链接、服务模块、右上角的问号

```shell
1） 拷贝容器内文件并修改
# 不同版本可能他的js文件名不一样，不过都是在对应的目录，前缀和后缀都一样的，自己进pod里面查看文件名即可。都是以main.xxxx.js或者app.xxxx.js这样。
mkdir -p /root/bkce7.1-install/tuoming/paas3-webf

cd /root/bkce7.1-install/tuoming/paas3-webf

kubectl cp -n blueking -c web $(kubectl get po -n blueking |grep bkpaas3-webfe-web| awk '{print $1}'):/var/www/static/js/main.57fdaaf5.js main.57fdaaf5.js

kubectl cp -n blueking -c web $(kubectl get po -n blueking |grep bkpaas3-webfe-web| awk '{print $1}'):/var/www/static/css/main.3ea6be7b.css main.3ea6be7b.css

# 修改logo文字，把蓝鲸开发者中心改成开发者中心
sed -i "s/\\u84DD\\u9CB8\\u5F00\\u53D1\\u8005\\u4E2D\\u5FC3/\\u5F00\\u53D1\\u8005\\u4E2D\\u5FC3/g" main.57fdaaf5.js

# 修改title，把腾讯蓝鲸智云改成运维平台
sed -i 's/\\u817E\\u8BAF\\u84DD\\u9CB8\\u667A\\u4E91/\\u8FD0\\u7EF4\\u5E73\\u53F0/g' main.57fdaaf5.js

# main.3ea6be7b.css
# 修改底部链接 都在对应的模块里末尾添加display:none
# 这个是去除技术支持|社区论坛|产品官网
.ps-sample-footer[data-v-13b6847b]
# 这个是去除图表和新手入门使用指南
.paas-content-boxpanel
# 这个是去除服务模块
.ps-nav li>a.has-angle[data-v-816cc728]
# 这个是去除右上角的问号
.top-bar-wrapper .header-help.is-left

2）复制已修改的内容到pvc挂载的目录里。（如果没有，参考一下cmdb的logo文字修改的内容，先创建对应的pv和pvc）
for i in $(ls);do cp $i /data/bcs/localpv/volblueking-web/paas3-webf_$i;done

3）bkpaas3-webfe 默认没有开放pvc挂载，需要手动增加配置，修改对应的deployment
mkdir -p /root/bkce7.1-install/tuoming/chart
cd /root/bkce7.1-install/tuoming/chart
# 包如果不存在/root/bkce7.1-install/charts/里面，那就再root的.cache里面
tar -zxvf /root/.cache/helm/repository/bkpaas3-1.1.1-beta.2.tgz -C ./

vim bkpaas3/charts/webfe/templates/web-deployment.yaml # 在bkpaas3/charts/webfe/templates/web-deployment.yaml文件末尾添加以下内容：
      {{- if .Values.extraVolumeMounts }}
      {{- "\n" }}{{- print "volumeMounts:" | indent 10 }}
      {{- include "common.tplvalues.render" (dict "value" .Values.extraVolumeMounts "context" $) | nindent 12 }}
      {{- end }}
      {{- if .Values.extraVolumes }}
      {{- "\n" }}{{- print "volumes:" | indent 6 }}
      {{- include "common.tplvalues.render" (dict "value" .Values.extraVolumes "context" $) | nindent 8 }}
      {{- end }}

4）打包新的bkpaas3
# 如果安装包在/root/bkce7.1-install/charts里 则执行mv命令，不在则不需要执行
mv /root/bkce7.1-install/charts/bkpaas3-1.1.1-beta.2.tgz{,.bak-$(date +%F)}
# 把修改完的bkpaas3打包到/root/bkce7.1-install/charts/
helm package bkpaas3 --version=1.1.1-beta.2 -d /root/bkce7.1-install/charts/
# 如果是在线安装的，还需要修改04-bkmonitor.yaml.gotmpl文件里chart指定位置，如果不是，这命令不用执行修改。
sed -i 's#blueking/bkpaas3#/root/bkce7.1-install/charts/bkpaas3-1.1.1-beta.2.tgz#g' /root/bkce7.1-install/blueking/base-blueking.yaml.gotmpl

5）增加custom对应pvc指向
cd /root/bkce7.1-install/blueking

cat >> environments/default/bkpaas3-custom-values.yaml.gotmpl << EOF
webfe:
  extraVolumes:
    - name: blueking-web-volume
      persistentVolumeClaim:
        claimName: blueking-web-pvc
  
  extraVolumeMounts:
    - name: blueking-web-volume
      mountPath: /var/www/static/js/main.57fdaaf5.js
      subPath: paas3-webf_main.57fdaaf5.js
      readOnly: true
  
    - name: blueking-web-volume
      mountPath: /var/www/static/css/main.3ea6be7b.css
      subPath: paas3-webf_main.3ea6be7b.css
      readOnly: true
EOF

6）重新sync bkpaas3
helmfile -f base-blueking.yaml.gotmpl -l name=bk-paas sync

7）上面sync执行结束没报错检查一下有没有成功挂载
kubectl describe pod $(kubectl get po -n blueking | grep bkpaas3-webfe-web | awk '{print $1}') -n blueking |grep -i mounts -A 5

8) 没问题就去访问开发者页面，应该是修改成功了，需要先重新加载以下页面，去到开发者页面用Ctrl+F5去强制刷新即可。
```



### API网关

#### 修改title、文档、搜索栏、logo文字、底部链接

```shell
1） 拷贝容器内文件并修改
# 不同版本可能他的js文件名不一样，不过都是在对应的目录，前缀和后缀都一样的，自己进pod里面查看文件名即可。都是以main.xxxx.js或者app.xxxx.js这样。
mkdir -p /root/bkce7.1-install/tuoming/apigateway-web

cd /root/bkce7.1-install/tuoming/apigateway-web

kubectl cp -n blueking -c bk-apigateway-dashboard-fe $(kubectl get po -n blueking |grep bk-apigateway-dashboard-fe| awk '{print $1}'):/app/dist/static/js/main.cb5ce3bcd902f8c98d6f.js main.cb5ce3bcd902f8c98d6f.js

kubectl cp -n blueking -c bk-apigateway-dashboard-fe $(kubectl get po -n blueking |grep bk-apigateway-dashboard-fe| awk '{print $1}'):/app/dist/static/css/main.8b4150dce4b6a2729a7d.css main.8b4150dce4b6a2729a7d.css

kubectl cp -n blueking -c bk-apigateway-dashboard $(kubectl get po -n blueking |grep bk-apigateway-dashboard|grep -v bk-apigateway-dashboard-fe | grep -v celery|grep -v beat| awk '{print $1}'):/app/apigateway/conf/default.py default.py

# 修改文件内容
# title
sed -i 's/腾讯蓝鲸智云/运维平台/g' main.cb5ce3bcd902f8c98d6f.js
# 文档内容
sed -i 's/蓝鲸智云/运维平台/g' default.py
# 底部链接，修改main.8b4150dce4b6a2729a7d.css文件，在.monitor-navigation-footer这个模块里的末尾添加上display:none 具体如下：
.monitor-navigation-footer{height:52px;width:100%;margin:32px 0 0;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;border-top:1px solid #dcdee5;color:#63656e;font-size:12px;display:none}

# logo隐藏，修改main.8b4150dce4b6a2729a7d.css文件，在.ps-logo这个模块里的末尾添加上display:none 具体如下：
.ps-logo{height:22px;cursor:pointer;display:none}

2）复制已修改的内容到pvc挂载的目录里。（如果没有，参考一下cmdb的logo文字修改的内容，先创建对应的pv和pvc）
for i in $(ls);do cp $i /data/bcs/localpv/volblueking-web/apigateway-web_$i;done

3）增加custom对应pvc指向
cd /root/bkce7.1-install/blueking

cat >> environments/default/bkapigateway-custom-values.yaml.gotmpl << EOF
dashboardFe:
  extraVolumes:
    - name: blueking-web-volume
      persistentVolumeClaim:
        claimName: blueking-web-pvc
  
  extraVolumeMounts:
    - name: blueking-web-volume
      mountPath: /app/dist/static/js/main.cb5ce3bcd902f8c98d6f.js
      subPath: apigateway-web_main.cb5ce3bcd902f8c98d6f.js
      readOnly: true
  
    - name: blueking-web-volume
      mountPath: /app/dist/static/css/main.8b4150dce4b6a2729a7d.css
      subPath: apigateway-web_main.8b4150dce4b6a2729a7d.css
      readOnly: true

dashboard:
  extraVolumes:
    - name: blueking-web-volume
      persistentVolumeClaim:
        claimName: blueking-web-pvc
  
  extraVolumeMounts:
    - name: blueking-web-volume
      mountPath: /app/apigateway/conf/default.py
      subPath: apigateway-web_default.py
EOF

4）重新sync apigateway
helmfile -f base-blueking.yaml.gotmpl -l name=bk-apigateway sync

5）上面sync执行结束没报错检查一下有没有成功挂载
kubectl describe pod $(kubectl get po -n blueking |grep bk-apigateway-dashboard-fe| awk '{print $1}') -n blueking |grep -i mounts -A 5

kubectl describe pod $(kubectl get po -n blueking |grep bk-apigateway-dashboard|grep -v bk-apigateway-dashboard-fe | grep -v celery|grep -v beat| awk '{print $1}') -n blueking |grep -i mounts -A 5

6) 没问题就去访问开发者页面里面的api网关，应该是修改成功了，需要先重新加载以下页面，去到开发者页面里面的api网关用Ctrl+F5去强制刷新即可。
```



### 标准运维

#### 修改title和底部链接

```shell
1）获取安装包、官网下载对应的安装包上传到服务器
# 能连接外网可以直接wget下载
mkdir -p /root/bkce7.1-install/tuoming/saas
cd /root/bkce7.1-install/tuoming/saas
wget https://bkopen-1252002024.file.myqcloud.com/saas-paas3/bk_sops/bk_sops-V3.28.13.tar.gz

2）解压安装包，并修改对应文件内容
tar -zxvf bk_sops-V3.28.13.tar.gz
cd bk_sops/src
tar -zxvf layer.tar.gz
# 修改title
sed -i 's/腾讯蓝鲸智云/运维平台/g' app/gcloud/conf/sites/community/ver_settings.py
sed -i 's/腾讯蓝鲸智云/运维平台/g' app/gcloud/conf/sites/enterprise/ver_settings.py

# 修改底部栏
vim app/gcloud/core/footer/sites/open/footer.py
把里面的default改成空值具体如下：
# -*- coding: utf-8 -*-
"""
Tencent is pleased to support the open source community by making 蓝鲸智云PaaS平台社区版 (BlueKing PaaS Community
Edition) available.
Copyright (C) 2017 THL A29 Limited, a Tencent company. All rights reserved.
Licensed under the MIT License (the "License"); you may not use this file except in compliance with the License.
You may obtain a copy of the License at
http://opensource.org/licenses/MIT
Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on
an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the
specific language governing permissions and limitations under the License.
"""

from django.utils.translation import ugettext_lazy as _

from gcloud.core.models import EnvironmentVariables


def i18n_footer(language):
    default = ""

    footer_key = "BKAPP_FOOTER"
    if language != "zh-cn":
        footer_key = "BKAPP_FOOTER_{}".format(language.upper())
    return EnvironmentVariables.objects.get_var(footer_key, default)


FOOTER = i18n_footer

3）重新打包标准运维
rm -rf layer.tar.gz
tar -czvf layer.tar.gz app
rm -rf app
cd /root/bkce7.1-install/tuoming/saas
rm -rf bk_sops-V3.28.13.tar.gz
tar -czvf bk_sops-V3.28.14.tar.gz bk_sops Makefile .Version
rm -rf .Version bk_sops Makefile

4）把重新打包完的包下载到本地，再上传安装即可
去到开发者中心-->>应用开发，找到标准运维，点开进去，找到左侧的应用引擎-->>包版本管理-->>上传新版本，把下载到本地的安装包上传上去，打开部署管理-->>生产环境-->>部署至生产环境，勾选总在创建进程实例前拉取镜像（这个一定要勾选才有效），然后按照标准运维的安装步骤，先部署完default模块，然后再去部署api、pipeline、callback(其他几个模块一样需要选择总在创建进程实例前拉取镜像)

5）部署完成都没问题之后重新打开标准运维页面即可看到修改成功，没有的话先刷新缓存看看。
```



### 流程服务

#### 修改title和底部链接

```shell
1）获取安装包、官网下载对应的安装包上传到服务器
# 能连接外网可以直接wget下载
mkdir -p /root/bkce7.1-install/tuoming/saas
cd /root/bkce7.1-install/tuoming/saas
wget https://bkopen-1252002024.file.myqcloud.com/saas-paas3/bk_itsm/bk_itsm-V2.6.6.tar.gz


2）解压安装包，并修改对应文件内容
tar -zxvf bk_itsm-V2.6.6.tar.gz
cd bk_itsm/src/
tar -zxvf layer.tar.gz
# 修改title
sed -i 's/腾讯蓝鲸智云/运维平台/g' app/adapter/core/sites/open/show.py
sed -i 's/腾讯蓝鲸智云/运维平台/g' app/adapter/core/sites/ieod/show.py

# 修改底部栏 两个文件
vim app/adapter/core/sites/open/show.py
vim app/adapter/core/sites/ieod/show.py
把里面的FOOTER改成空值具体如下：
# -*- coding: utf-8 -*-
"""
Tencent is pleased to support the open source community by making BK-ITSM 蓝鲸流程服务 available.

Copyright (C) 2021 THL A29 Limited, a Tencent company.  All rights reserved.

BK-ITSM 蓝鲸流程服务 is licensed under the MIT License.

License for BK-ITSM 蓝鲸流程服务:
--------------------------------------------------------------------
Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated
documentation files (the "Software"), to deal in the Software without restriction, including without limitation
the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software,
and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial
portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT
LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
"""
from django.utils.translation import gettext_lazy as _
from django.conf import settings

DOC_URL = settings.BK_IEOD_DOC_URL


def get_title():
    return "{} | {}".format(_("流程服务"), _("运维平台"))


def get_footer():
    FOOTER = ""
    return FOOTER


LOGIN_URL = settings.BK_IEOD_LOGIN_URL


3）重新打包流程服务
rm -rf layer.tar.gz
tar -czvf layer.tar.gz app
rm -rf app
cd /root/bkce7.1-install/tuoming/saas
rm -rf bk_itsm-V2.6.6.tar.gz
tar -czvf bk_itsm-V2.6.7.tar.gz bk_itsm Makefile .Version
rm -rf .Version bk_itsm Makefile

4）把重新打包完的包下载到本地，再上传安装即可
去到开发者中心-->>应用开发，找到流程服务，点开进去，找到左侧的应用引擎-->>包版本管理-->>上传新版本，把下载到本地的安装包上传上去，打开部署管理-->>生产环境-->>部署至生产环境，勾选总在创建进程实例前拉取镜像（这个一定要勾选才有效）

5）部署完成都没问题之后重新打开流程服务页面即可看到修改成功，没有的话先刷新缓存看看。
```



### 登录页面

#### title、背景图片、logo、用户协议、底部栏、中英文切换

```shell
1） 拷贝容器内文件并修改
# 不同版本可能他的js文件名不一样，不过都是在对应的目录，前缀和后缀都一样的，自己进pod里面查看文件名即可。都是以main.xxxx.js或者app.xxxx.js这样。
mkdir -p /root/bkce7.1-install/tuoming/login-web

cd /root/bkce7.1-install/tuoming/login-web

kubectl cp -n blueking -c login $(kubectl get po -n blueking |grep login-web| awk '{print $1}'):bklogin/templates/login.html login.html

# 修改文件内容，因为修改的比较多，所以直接替换掉login.html。先备份原本的。把原本他引用的图片删除了，替换了一张背景图。
# 备份
mv login.html login.html.bak
# 创建新的login.html
cat >> login.html << EOF
{% load i18n %}
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <link rel="icon" type="image/x-icon" href="{{STATIC_URL}}favicon.ico">
        <link href="{{STATIC_URL}}css/bk.{{CSS_SUFFIX}}" rel="stylesheet" type="text/css" />
        <link href="{{STATIC_URL}}assets/bk-icon-2.0/iconfont.css" rel="stylesheet" type="text/css" />
        <link href="{{STATIC_URL}}assets/blueking-icon/index.css" rel="stylesheet" type="text/css" />
        <link href="{{STATIC_URL}}css/login.{{CSS_SUFFIX}}?v={{STATIC_VERSION}}" rel="stylesheet" type="text/css" />
        <title>{% trans '登录 | 深体运维平台' %}</title>

        <!-- 优化背景图样式 -->
        <style>
            .page-content {
                position: relative;
                height: 100vh;
                width: 100%;
                overflow: hidden;
                background: url('{{STATIC_URL}}img/logo/bg3.png') no-repeat center center fixed;
                background-size: cover;
            }
            #particles-js {
                display: none !important; /* 完全隐藏粒子背景 */
            }
            .login-from {
                z-index: 10; /* 确保登录框在背景之上 */
            }
        </style>

        {% if is_plain %}
          <style>
              .login-from {
                left: 50% !important;
                top: 58% !important;
                margin: 0 !important;
                transform: translate(-50%, -58%);
              }
              .protocol-btn {
                display: none !important;
              }
          </style>
        {% endif %}
    </head>
    <body>
        <div class="page-content">
            <div id="particles-js"></div>
            <div class="login-from">
                <div class="logo-title">
                    <img class="logo-img" src="{{STATIC_URL}}{% trans 'img/logo/logo_ch.png' %}" alt="">
                </div>
                <div class="from-detail">
                    <div class="form-login">
                        <form action="{{ app_path }}" method="post" id="login-form" onsubmit="return refresh_token()">{% csrf_token %}
                            <div class="account-content">
                                {% if user_expired %}
                                <p class="error-text">{% trans '该账户已到期，如需续期，请联系' %}<span id="admin">{% trans '管理员' %}</span></p>
                                <p class="tips">
                                    <span>{% trans '提示信息' %}</span>
                                </p>
                                {% endif %}
                            </div>
                            <div class="user group-control">
                                <input id="user" type="text" name="username" placeholder="{% trans '请输入用户名' %}">
                            </div>
                            <div class="pwd group-control">
                                <i class="bk-icon icon-invisible-eye" id="invisible"></i>
                                <input class="password" id="password" type="password" name="password" value="" placeholder="{% trans '请输入密码' %}">
                            </div>
                            <p class="change-password">
                                {% if error_message %}
                                <span>{{ error_message }}</span>
                                    {% if token_set_password_url %}
                                        ,<a href="{{ token_set_password_url }}" target="_blank">{% trans '请修改密码' %}</a>
                                    {% endif %}
                                {% endif %}
                            </p>
                            <div>
                                <input type="hidden" name="next" value="{{ next }}" />
                                <input type="hidden" name="app_id" value="{{ app_id }}">
                            </div>
                            <div class="btn-content clearfix">
                                <button class="login-btn" id="login-btn">{% trans '立即登录' %}</button>
                                <!-- <span class="protocol-btn">查看用户协议</span> -->
                            </div>
                            <div class="action clearfix">
                                <!-- {% if "/plain/" not in APP_PATH %} -->
                                <!-- {% endif %} -->
                                <a href="{{ forget_password_url }}" class="password-btn fr" target="_blank">{% trans '忘记密码？' %}</a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <!-- 查看用户协议 -->
        {% include "agreement.html" %}
        <!-- 浏览器验证 -->
        <div class="error-message-content is-chrome">
            <span>{% trans '您的浏览器非Chrome，建议您使用最新版本的Chrome浏览，以保证最好的体验效果' %}</span><i class="bk-icon icon-close-circle-shape" id="close-chrome"></i>
        </div>
    </body>
    <!-- js 国际化 -->
    <script type="text/javascript" src="{{SITE_URL}}jsi18n/i18n/"></script>
    <script src="{{STATIC_URL}}assets/jquery-1.10.2.min.js"></script>
    <script src="{{STATIC_URL}}js/login.js"></script>
    <script src="{{STATIC_URL}}js/particles.js"></script>
    <script src="{{STATIC_URL}}js/app.js"></script>
    <script src="{{STATIC_URL}}js/stats.js"></script>
    <script type="text/javascript">
        {% if login_redirect_to %}
        window.open("{{login_redirect_to}}");
        {% endif %}

        // 调试：确保图片路径正确
        console.log('背景图片路径:', '{{STATIC_URL}}img/logo/bg3.png');
    </script>
    <script src="{{STATIC_URL}}assets/jsencrypt-3.2.1.min.js?v={{STATIC_VERSION}}"></script>
    <script type="text/javascript">
        PASSWORD_RSA_PUBLIC_KEY = "{{ PASSWORD_RSA_PUBLIC_KEY }}"
        ENABLE_PASSWORD_RSA_ENCRYPTED = "{{ ENABLE_PASSWORD_RSA_ENCRYPTED }}" === "true"

        // 密码传输rsa加密
        function rsa_encrypt_password() {
            var public_key = window.atob(PASSWORD_RSA_PUBLIC_KEY).split('\n').join("");
            var password = $('#password').val();
            var encrypt = new JSEncrypt();
            encrypt.setKey(public_key);
            var encrypted = encrypt.encrypt(password);
            $('#password').val(encrypted);
        }
        $(document).ready(function(){
             if (ENABLE_PASSWORD_RSA_ENCRYPTED) {
                 $('#login-form').submit(() => {
                     rsa_encrypt_password();
                });
            }
            var token_set_password_url = "{{ token_set_password_url }}";
            var error_message = "{{ error_message }}";
            if (token_set_password_url !== "") {
                window.location.href = token_set_password_url + '&data=' + JSON.stringify(error_message);
            }
        })
    </script>
</html>
EOF

# 以下需要自己准备图片
一张登录页面背景图 3840 x 2160 命名为 bg3.png
一张登录框logo图 812 x 136 命名为 logo_ch.png
一张标题的标签图  16 x 16 命名为 favicon.ico
# 把图片上传到/root/bkce7.1-install/tuoming/login-web

2）复制已修改的内容到pvc挂载的目录里。（如果没有，参考一下cmdb的logo文字修改的内容，先创建对应的pv和pvc）
for i in $(ls|grep -v bak);do cp $i /data/bcs/localpv/volblueking-web/login-web_$i;done

3）增加custom对应pvc指向
cd /root/bkce7.1-install/blueking

cat >> environments/default/bkuser-custom-values.yaml.gotmpl << EOF
login:
  volumes:
    - name: blueking-web-volume
      persistentVolumeClaim:
        claimName: blueking-web-pvc

  volumeMounts:
    - name: blueking-web-volume
      mountPath: /app/static/img/logo/bg3.png
      subPath: login-web_bg3.png
      readOnly: true

    - name: blueking-web-volume
      mountPath: /app/static/favicon.ico
      subPath: login-web_favicon.ico
      readOnly: true

    - name: blueking-web-volume
      mountPath: /app/static/img/logo/logo_ch.png
      subPath: login-web_logo_ch.png
      readOnly: true

    - name: blueking-web-volume
      mountPath: /app/bklogin/templates/login.html
      subPath: login-web_login.html
      readOnly: true
EOF

4）重新sync bk-user
helmfile -f base-blueking.yaml.gotmpl -l name=bk-user sync

5）上面sync执行结束没报错检查一下有没有成功挂载
kubectl describe pod $(kubectl get po -n blueking |grep login-web | awk '{print $1}') -n blueking |grep -i mounts -A 9

6）部署完成都没问题之后重新打开登录页面即可看到修改成功，没有的话先刷新缓存看看。
```



### 登录桌面

#### 删除水印、问号帮助按钮、添加主题背景、删除皮肤设置

```shell
1） 拷贝容器内文件并修改
# 不同版本可能他的js文件名不一样，不过都是在对应的目录，前缀和后缀都一样的，自己进pod里面查看文件名即可。都是以main.xxxx.js或者app.xxxx.js这样。
mkdir -p /root/bkce7.1-install/tuoming/console-web

cd /root/bkce7.1-install/tuoming/console-web

kubectl cp -n blueking -c bk-console $(kubectl get po -n blueking |grep bk-console-web| awk '{print $1}'):/app/templates/desktop/index.html index.html

kubectl cp -n blueking -c bk-console $(kubectl get po -n blueking |grep bk-console-web| awk '{print $1}'):/app/templates/desktop/desk_setting.html desk_setting.html

kubectl cp -n blueking -c bk-console $(kubectl get po -n blueking |grep bk-console-web| awk '{print $1}'):/app/static/css/base.min.css base.min.css

kubectl cp -n blueking -c bk-console $(kubectl get po -n blueking |grep bk-console-web| awk '{print $1}'):/app/static/css/appearance.min.css appearance.min.css

# 修改文件内容：
sed -i 's/腾讯蓝鲸智云/运维平台/g' ./*.html

vim index.html # 把index.html以下的内容删除掉即可：

            <!-- 壁纸水印 -->
            <div  id="water-mark" class="bk-watermark"></div>
            
        .bk-watermark{position:fixed;bottom:60px;right:20px;width:400px;height:80px;opacity:.7;background: url({{ STATIC_URL }}{% trans 'img/base_ui/watermark.png' %}) no-repeat;}
        .appbtn span.lapp_mark{border-radius:0px;display:block;height:24px;width:24px;margin-left:25px;margin-top:-23px;background: url({{ STATIC_URL }}{% trans 'img/app_logo/light_app.png' %}) no-repeat;}
        #appmanage .amg_close{background:url({{ STATIC_URL }}{% trans 'img/base_ui/desk_sprite.png' %}) no-repeat -350px -350px;cursor:pointer;width:90px;height:37px;position:absolute;top:25px;right:10px}

                <li><a href="https://bk.tencent.com/docs/markdown/PaaS平台/产品白皮书/产品简介/README.md" target="blank" class="">{% trans '产品文档' %}</a></li>
                <li><a href="javascript:;" class="about">{% trans '蓝鲸官网' %}</a></li>

<li><a href="javascript:;" class="bk_service_agreement">{% trans '服务协议' %}</a></li>



vim base.min.css  # 找到这个模块，在末尾添加display:none
.dock-left .dock-applist .appbtn_dock{margin-left:1px}.dock-left .dock-tool-helps,.dock-left .dock-tool-search,.dock-left .dock-tool-style,.dock-left .dock-tool-userce,.dock-right .dock-applist .appbtn_dock,.dock-right .dock-tool-helps,.dock-right .dock-tool-search,.dock-right .dock-tool-style,.dock-right .dock-tool-userce{margin-left:3px;display:none}


vim appearance.min.css # 找到这个模块，在末尾添加display:none
.title li a{color:#555;cursor:pointer;text-decoration:none;display:none}

# 准备好对应的桌面背景图  名为 wallpaper1.jpg wallpaper2.jpg
# 一张标题的标签图  16 x 16 命名为 favicon.ico
# 一张app的默认logo图 命名为 default.png
# 图片上传到/root/bkce7.1-install/tuoming/console-web


2）复制已修改的内容到pvc挂载的目录里。（如果没有，参考一下cmdb的logo文字修改的内容，先创建对应的pv和pvc）
for i in $(ls);do cp $i /data1/bcs/localpv/volblueking-web/console-web_$i;done


3）增加custom对应pvc指向
cd /root/bkce7.1-install/blueking

cat >> environments/default/bkconsole-custom-values.yaml.gotmpl << EOF
extraVolumes:
  - name: blueking-web-volume
    persistentVolumeClaim:
      claimName: blueking-web-pvc

extraVolumeMounts:
  - name: blueking-web-volume
    mountPath: /app/templates/desktop/index.html
    subPath: console-web_index.html

  - name: blueking-web-volume
    mountPath: /app/templates/desktop/desk_setting.html
    subPath: console-web_desk_setting.html

  - name: blueking-web-volume
    mountPath: /app/static/css/base.min.css
    subPath: console-web_base.min.css

  - name: blueking-web-volume
    mountPath: /app/static/css/appearance.min.css
    subPath: console-web_appearance.min.css

  - name: blueking-web-volume
    mountPath: /app/static/img/wallpaper/wallpaper1.jpg
    subPath: console-web_wallpaper1.jpg

  - name: blueking-web-volume
    mountPath: /app/static/img/wallpaper/wallpaper2.jpg
    subPath: console-web_wallpaper2.jpg

  - name: blueking-web-volume
    mountPath: /app/static/img/app_logo/default.png
    subPath: console-web_default.png

  - name: blueking-web-volume
    mountPath: /app/static/img/favicon.ico
EOF



4）重新sync bk-console
helmfile -f base-blueking.yaml.gotmpl -l name=bk-console sync

5）上面sync执行结束没报错检查一下有没有成功挂载
kubectl describe pod $(kubectl get po -n blueking |grep console-web | awk '{print $1}') -n blueking |grep -i mounts -A 9

6）部署完成都没问题之后重新登录页面即可看到修改成功，没有的话先刷新缓存看看。
```

